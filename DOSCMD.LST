                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   Tablacus DOS call for MSX
                                ;   Gaku
                                
                                    INCLUDE "DEF.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       0001                     VER_BCD EQU 00001H
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       0402                     MAPPER  EQU 00402H
                                
       F307                     FCB11   EQU 0F307H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F398                     JP_IX   EQU 0F398H
       F3AF                     LINL32  EQU 0F3AFH
       F3AE                     LINL40  EQU 0F3AEH
       F3B0                     LINLEN  EQU 0F3B0H
                                
       F41F                     KBUF    EQU 0F41FH; 318
       F55E                     BUF EQU 0F55EH; 258
                                
       F662                     DIMFLG  EQU 0F662H
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F676                     TXTTAB  EQU 0F676H
       F6A7                     TEMP    EQU 0F6A7H
       F6AF                     SAVTXT  EQU 0F6AFH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6B5                     DOT EQU 0F6B5H
       F6B9                     ONELIN  EQU 0F6B9H
                                
       FAF8                     EXBRSA  EQU 0FAF8H
                                
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCC5                     SLTTBL  EQU 0FCC5H
                                
       FE0D                     H_CMD   EQU 0FE0DH
                                
       FFCA                     EXTBIOS EQU 0FFCAH
                                
       B9D0                     START   EQU 0B9D0H
                                
       B8C8                     BUF512  EQU TERM-512    ;_RDABS _WRABS のバッファ
       B8C5                     BDOS0   EQU BUF512-3
       B8C8                     ALT_MEM EQU BUF512
       B908                     ALT_MEM2    EQU ALT_MEM+64
       B948                     ALT_MEM3    EQU ALT_MEM2+64
       B8C8                     FDRV    EQU BUF512
       B8C9                     FNAME   EQU BUF512+1
       B8ED                     BUFSTR  EQU BUF512+37
                                
       8001                     BASIC_DEF   EQU 08001H
       C201                     BASIC_START1    EQU 0C201H
       003B                     ENASUB  EQU 0003BH
[EOF:DEF.ASM:UTF_8]
                                
000000 B9C9                         ORG START-7
                                
                                ;   MSX BINARY HEADER
000000 B9C9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 B9CA D0B9                    DW  START
                                ;   MSX BINARY END ADDRESS
000003 B9CC FDC1                    DW  LAST
                                ;   MSX BINARY EXEC ADDRESS
000005 B9CE D0B9                    DW  START
                                
000007 B9D0                         ORG START
                                
                                    INCLUDE "INIT.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
000007 B9D0 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
000009 B9D2 CD7DF3          17      CALL    BDOS
00000C B9D5 78               4      LD  A,B
00000D B9D6 324DBD          13      LD  (MAJOR_VER),A
000010 B9D9 21918A          10      LD  HL,08A91H
000013 B9DC ED52            15      SBC HL,DE
000015 B9DE 2005            12      JR  NZ,NOTABLACUS
000017 B9E0 3E01             7      LD  A,1
000019 B9E2 324DBD          13      LD  (MAJOR_VER),A
       B9E5                     NOTABLACUS:
                                                    ;BASICのフリーエリア位置をずらす
00001C B9E5 2101C2          10      LD  HL,BASIC_START1
00001F B9E8 B7               4      OR  A
000020 B9E9 2803            12      JR  Z,DOS1START
000022 B9EB 2112C0          10      LD  HL,BASIC_START2
       B9EE                     DOS1START:
000025 B9EE 2276F6          16      LD  (TXTTAB),HL
000028 B9F1 AF               4      XOR A
000029 B9F2 77               7      LD  (HL),A
00002A B9F3 2B               6      DEC HL
00002B B9F4 77               7      LD  (HL),A
00002C B9F5 210000          10      LD  HL,0
00002F B9F8 220180          16      LD  (BASIC_DEF),HL
                                
000032 B9FB F3               4      DI
000033 B9FC 3A41F3          13      LD  A,(RAMAD0)
000036 B9FF CDB2BF          17      CALL    ENASLT_00H
                                
000039 BA02 3E                      DB  03EH    ;LD A,?
00003A BA03 F1              10      POP AF
00003B BA04 320DFE          13      LD  (H_CMD),A
                                
00003E BA07 3EC3             7      LD  A,0C3H      ;JP
                                
000040 BA09 2103C0          10      LD  HL,CPM_WBOOT
000043 BA0C 320000          13      LD  (00000H),A
000046 BA0F 220100          16      LD  (00001H),HL
                                
000049 BA12 21C5B8          10      LD  HL,BDOS0
00004C BA15 320500          13      LD  (00005H),A
00004F BA18 220600          16      LD  (00006H),HL
                                
000052 BA1B 21D4BA          10      LD  HL,BDOS1
000055 BA1E 32C5B8          13      LD  (BDOS0),A
000058 BA21 22C6B8          16      LD  (BDOS0+1),HL
                                
00005B BA24 320EFE          13      LD  (H_CMD+1),A
00005E BA27 214EBD          10      LD  HL,_CMD
000061 BA2A 220FFE          16      LD  (H_CMD+2),HL
                                
000064 BA2D 3A4DBD          13      LD  A,(MAJOR_VER)
000067 BA30 B7               4      OR  A
000068 BA31 2043            12      JR  NZ,ISC_END
                                                ;インタースロットコール
00006A BA33 3EC3             7      LD  A,0C3H      ;JP
00006C BA35 21A2C1          10      LD  HL,RDSLT
00006F BA38 320C00          13      LD  (_RDSLT),A
000072 BA3B 220D00          16      LD  (_RDSLT+1),HL
                                
000075 BA3E 21C0C1          10      LD  HL,WRSLT
000078 BA41 321400          13      LD  (_WRSLT),A
00007B BA44 221500          16      LD  (_WRSLT+1),HL
                                
00007E BA47 2153C1          10      LD  HL,CALSLT
000081 BA4A 321C00          13      LD  (_CALSLT),A
000084 BA4D 221D00          16      LD  (_CALSLT+1),HL
                                
000087 BA50 21AAC0          10      LD  HL,ENASLT
00008A BA53 322400          13      LD  (_ENASLT),A
00008D BA56 222500          16      LD  (_ENASLT+1),HL
                                
000090 BA59 2143C1          10      LD  HL,CALLF
000093 BA5C 323000          13      LD  (_CALLF),A
000096 BA5F 223100          16      LD  (_CALLF+1),HL
                                                ;割り込み
000099 BA62 21DCC1          10      LD  HL,INT38H
00009C BA65 323800          13      LD  (00038H),A
00009F BA68 223900          16      LD  (00038H+1),HL
                                
0000A2 BA6B 21D0BF          10      LD  HL,AT_3B
0000A5 BA6E 113B00          10      LD  DE,ENASUB
0000A8 BA71 011000          10      LD  BC,AT_3B_E-AT_3B
0000AB BA74 EDB0                    LDIR
       BA76                     ISC_END:
0000AD BA76 3AC1FC          13      LD  A,(EXPTBL)
0000B0 BA79 CDB2BF          17      CALL    ENASLT_00H
0000B3 BA7C FB               4      EI
                                
0000B4 BA7D 11A8BA          10      LD  DE,TITLE
0000B7 BA80 0E09             7      LD  C,9
0000B9 BA82 CD7DF3          17      CALL    BDOS
0000BC BA85 3A4DBD          13      LD  A,(MAJOR_VER)
0000BF BA88 B7               4      OR  A
0000C0 BA89 2814            12      JR  Z,MSX1
0000C2 BA8B 3D               4      DEC A
0000C3 BA8C 2809            12      JR  Z,TABLACUS
0000C5 BA8E 1E32             7      LD  E,'2'
0000C7 BA90 0E02             7      LD  C,2
0000C9 BA92 CD7DF3          17      CALL    BDOS
0000CC BA95 2808            12      JR  Z,MSX1
       BA97                     TABLACUS:
0000CE BA97 11C2BA          10      LD  DE,TITLET
0000D1 BA9A 0E09             7      LD  C,9
0000D3 BA9C CD7DF3          17      CALL    BDOS
       BA9F                     MSX1:
0000D6 BA9F 11B5BA          10      LD  DE,TITLE2
0000D9 BAA2 0E09             7      LD  C,9
0000DB BAA4 CD7DF3          17      CALL    BDOS
0000DE BAA7 C9              10      RET
                                
                                ; Version
       BAA8                     TITLE:
0000DF BAA8 5461626C61637573        DB  "Tablacus DOS$"
            20444F5324          
       BAB5                     TITLE2:
0000EC BAB5 20636D642076302E        DB  " cmd v0.01"
            3031                
0000F6 BABF 0D0A24                  DB  00DH,00AH,'$'
       BAC2                     TITLET:
0000F9 BAC2 28524F4D2924            DB  "(ROM)$"
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "DOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       BAC8                     TERM:
0000FF BAC8 78               4      LD  A,B
000100 BAC9 323ABD          13      LD  (TERMCODE),A
000103 BACC 210000          10      LD  HL,0
000106 BACF E5              11      PUSH    HL
000107 BAD0 2A40BD          16      LD  HL,(DEFAB)
00010A BAD3 E9               4      JP  (HL)
       BAD4                     BDOS1:
00010B BAD4 0C               4      INC C
00010C BAD5 0D               4      DEC C
                                                ;BDOS0+013Hを0にするとバッチ停止されるため0が書き込みされる場合がある
00010D BAD6 CA0000          10      JP  Z,0     ;だから、ここのアドレスをBDOS0+011HもしくはBDOS0+012Hにする
000110 BAD9 ED734BBD        20      LD  (SAVE_SP),SP
000114 BADD 323BBD          13      LD  (SAVE_A),A
000117 BAE0 79               4      LD  A,C
000118 BAE1 FE62             7      CP  062H        ;_TERM エラーコードを返して終了
00011A BAE3 28E3            12      JR  Z,TERM
00011C BAE5 3A4CBD          13      LD  A,(SAVE_SP+1)
00011F BAE8 87               4      ADD A,A
000120 BAE9 3804            12      JR  C,BDOS_SPOK
000122 BAEB ED7B0FC0        20      LD  SP,(BASSP)
       BAEF                     BDOS_SPOK:
000126 BAEF 79               4      LD  A,C
000127 BAF0 FE09             7      CP  9       ;_STROUT 文字列出力
000129 BAF2 CAA3BC          10      JP  Z,_SYS09
00012C BAF5 FE63             7      CP  063H        ;_DEFAB アボート終了ルーチンの定義
00012E BAF7 2004            12      JR  NZ,BDOS2
000130 BAF9 ED5340BD        20      LD  (DEFAB),DE
       BAFD                     BDOS2:
000134 BAFD FE1A             7      CP  01AH        ;_SETDTA DTAの設定
000136 BAFF 2004            12      JR  NZ,BDOS2_
000138 BB01 ED5342BD        20      LD  (_DTA),DE
       BB05                     BDOS2_:
00013C BB05 3244BD          13      LD  (SAVE_C),A
00013F BB08 FE0F             7      CP  00FH        ;_FOPEN ファイルオープン
000141 BB0A 3859            12      JR  C,SAVEFCB0
000143 BB0C FE12             7      CP  012H        ;_SNEXT ファイル検索 続き
000145 BB0E 2004            12      JR  NZ,NOBD12
000147 BB10 ED5B07F3        20      LD  DE,(FCB11)
       BB14                     NOBD12:
00014B BB14 FE18             7      CP  018H        ;_LOGIN ログインベクトルの獲得
00014D BB16 383A            12      JR  C,SAVEFCB36
00014F BB18 FE21             7      CP  021H        ;_RDRND ランダム読み出し
000151 BB1A 3849            12      JR  C,SAVEFCB0
000153 BB1C FE29             7      CP  028H+1      ;_WRZER ゼロ書き込みを伴うランダム書き込み+1
000155 BB1E 3832            12      JR  C,SAVEFCB36
000157 BB20 FE31             7      CP  031H        ;_DPARM ディスクパラメータの獲得
000159 BB22 282E            12      JR  Z,SAVEFCB36
00015B BB24 FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
00015D BB26 282A            12      JR  Z,SAVE_PATH
00015F BB28 FE42             7      CP  042H        ;_FNEW 新しいエントリの検索
000161 BB2A 2826            12      JR  Z,SAVE_PATH
000163 BB2C FE43             7      CP  043H        ;_OPEN ファイルハンドルのオープン
000165 BB2E 2822            12      JR  Z,SAVE_PATH
000167 BB30 FE44             7      CP  044H        ;_CREATE ファイルハンドルの作成
000169 BB32 281E            12      JR  Z,SAVE_PATH
00016B BB34 FE4C             7      CP  04CH        ;_HTEST ファイルハンドルの検査
00016D BB36 281A            12      JR  Z,SAVE_PATH
00016F BB38 FE4D             7      CP  04DH        ;_DELETE ファイル、サブディレクトリの削除
000171 BB3A 3829            12      JR  C,SAVEFCB0
000173 BB3C FE52             7      CP  051H+1      ;_FTIME ファイルの日付および時刻の獲得・設定
000175 BB3E 3812            12      JR  C,SAVE_PATH
000177 BB40 FE59             7      CP  059H        ;_GETCD カレントディレクトリの獲得
000179 BB42 3821            12      JR  C,SAVEFCB0
00017B BB44 FE5D             7      CP  05CH+1      ;_PFILE ファイル名の解析+1
00017D BB46 380A            12      JR  C,SAVE_PATH
00017F BB48 FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
000181 BB4A 2806            12      JR  Z,SAVE_PATH
000183 BB4C FE66             7      CP  066H        ;_EXPLAIN エラーコードの説明
000185 BB4E 2802            12      JR  Z,SAVE_PATH
000187 BB50 1813            12      JR  SAVEFCB0
       BB52                     SAVEFCB36:
       BB52                     SAVE_PATH:
000189 BB52 7A               4      LD  A,D
00018A BB53 FE3F             7      CP  03FH        ;ページ1にかぶる？
00018C BB55 380E            12      JR  C,SAVEFCB0
00018E BB57 FE80             7      CP  080H
000190 BB59 300A            12      JR  NC,SAVEFCB0
000192 BB5B 3E24             7      LD  A,36
000194 BB5D CB71             8      BIT 6,C     ;DOS2のファンクションコール？
000196 BB5F 2805            12      JR  Z,SAVEFCB1
000198 BB61 3E40             7      LD  A,64        ;DOS2CALLは64バイト設定する
00019A BB63 1801            12      JR  SAVEFCB1
       BB65                     SAVEFCB0:
00019C BB65 AF               4      XOR A
       BB66                     SAVEFCB1:
00019D BB66 323CBD          13      LD  (DE_MEM_SIZE),A
0001A0 BB69 B7               4      OR  A
0001A1 BB6A 2815            12      JR  Z,BDOS3
0001A3 BB6C C5              11      PUSH    BC
0001A4 BB6D E5              11      PUSH    HL
0001A5 BB6E ED5345BD        20      LD  (SAVE_DE),DE
0001A9 BB72 4F               4      LD  C,A
0001AA BB73 0600             7      LD  B,0
0001AC BB75 21C8B8          10      LD  HL,ALT_MEM
0001AF BB78 EB               4      EX  DE,HL
0001B0 BB79 D5              11      PUSH    DE
0001B1 BB7A EDB0                    LDIR
0001B3 BB7C AF               4      XOR A
0001B4 BB7D 12               7      LD  (DE),A
0001B5 BB7E D1              10      POP DE
0001B6 BB7F E1              10      POP HL
0001B7 BB80 C1              10      POP BC
       BB81                     BDOS3:
0001B8 BB81 AF               4      XOR A
0001B9 BB82 3248BD          13      LD  (SAVE_IX+1),A
0001BC BB85 79               4      LD  A,C
0001BD BB86 FE40             7      CP  040H        ;最初のエントリ検索
0001BF BB88 3826            12      JR  C,BDOS3IX   ;次のエントリ検索
0001C1 BB8A FE43             7      CP  042H+1      ;新しいエントリの検索
0001C3 BB8C 3022            12      JR  NC,BDOS3IX
0001C5 BB8E DD7C             9      LD  A,IXH
0001C7 BB90 FE3F             7      CP  03FH        ;ページ1にかぶる？
0001C9 BB92 381C            12      JR  C,BDOS3IX
0001CB BB94 FE80             7      CP  080H        ;
0001CD BB96 3018            12      JR  NC,BDOS3IX
0001CF BB98 DD2247BD        20      LD  (SAVE_IX),IX
0001D3 BB9C C5              11      PUSH    BC
0001D4 BB9D D5              11      PUSH    DE
0001D5 BB9E E5              11      PUSH    HL
0001D6 BB9F DDE5            15      PUSH    IX
0001D8 BBA1 E1              10      POP HL
0001D9 BBA2 1108B9          10      LD  DE,ALT_MEM2
0001DC BBA5 014000          10      LD  BC,64
0001DF BBA8 D5              11      PUSH    DE
0001E0 BBA9 EDB0                    LDIR
0001E2 BBAB DDE1            14      POP IX
0001E4 BBAD E1              10      POP HL
0001E5 BBAE D1              10      POP DE
0001E6 BBAF C1              10      POP BC
       BBB0                     BDOS3IX:
0001E7 BBB0 AF               4      XOR A
0001E8 BBB1 324ABD          13      LD  (SAVE_HL+1),A
0001EB BBB4 79               4      LD  A,C
0001EC BBB5 FE4E             7      CP  4EH     ;_RENAME ファイルあるいはサブディレクトリ名の変更
0001EE BBB7 281C            12      JR  Z,SAVE_HL1
0001F0 BBB9 FE4F             7      CP  4FH     ;_MOVE ファイルあるいはサブディレクトリの移動
0001F2 BBBB 2818            12      JR  Z,SAVE_HL1
0001F4 BBBD FE53             7      CP  53H     ;_HRENAME ファイルハンドルの名前の変更
0001F6 BBBF 2814            12      JR  Z,SAVE_HL1
0001F8 BBC1 FE54             7      CP  54H     ;_HMOVE ファイルハンドルの移動
0001FA BBC3 2810            12      JR  Z,SAVE_HL1
0001FC BBC5 FE5C             7      CP  05CH        ;_PFILE ファイル名の解析
0001FE BBC7 280C            12      JR  Z,SAVE_HL1
000200 BBC9 FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
000202 BBCB 2804            12      JR  Z,FIBCHECK
000204 BBCD FE42             7      CP  042H        ;_FNEW 新しいエントリ検索
000206 BBCF 201F            12      JR  NZ,BDOS3HL
       BBD1                     FIBCHECK:
000208 BBD1 1A               7      LD  A,(DE)
000209 BBD2 3C               4      INC A       ;DEがFIBならば0FFH
00020A BBD3 201B            12      JR  NZ,BDOS3HL
       BBD5                     SAVE_HL1:
00020C BBD5 7C               4      LD  A,H
00020D BBD6 FE3F             7      CP  03FH        ;ページ1にかぶる？
00020F BBD8 3816            12      JR  C,BDOS3HL
000211 BBDA FE80             7      CP  080H        ;
000213 BBDC 3012            12      JR  NC,BDOS3HL
000215 BBDE 2249BD          16      LD  (SAVE_HL),HL
000218 BBE1 C5              11      PUSH    BC
000219 BBE2 D5              11      PUSH    DE
00021A BBE3 014000          10      LD  BC,64
00021D BBE6 1148B9          10      LD  DE,ALT_MEM3
000220 BBE9 EDB0                    LDIR
000222 BBEB D1              10      POP DE
000223 BBEC C1              10      POP BC
000224 BBED 2148B9          10      LD  HL,ALT_MEM3
       BBF0                     BDOS3HL:
000227 BBF0 79               4      LD  A,C
000228 BBF1 FE2F             7      CP  02FH
00022A BBF3 CAB3BC          10      JP  Z,RDABS
00022D BBF6 FE30             7      CP  030H
00022F BBF8 CAFFBC          10      JP  Z,WRABS
       BBFB                     BDOS_EXEC:
000232 BBFB 3A3BBD          13      LD  A,(SAVE_A)
000235 BBFE CD7DF3          17      CALL    BDOS
                                
000238 BC01 F5              11      PUSH    AF
                                
000239 BC02 3A48BD          13      LD  A,(SAVE_IX+1)       ;最初のエントリ検索 + 次のエントリ検索
00023C BC05 B7               4      OR  A
00023D BC06 2815            12      JR  Z,BDOS4IX
00023F BC08 DD2A47BD        20      LD  IX,(SAVE_IX)
000243 BC0C C5              11      PUSH    BC
000244 BC0D D5              11      PUSH    DE
000245 BC0E E5              11      PUSH    HL
000246 BC0F DDE5            15      PUSH    IX
000248 BC11 D1              10      POP DE
000249 BC12 2108B9          10      LD  HL,ALT_MEM2
00024C BC15 014000          10      LD  BC,64
00024F BC18 EDB0                    LDIR
000251 BC1A E1              10      POP HL
000252 BC1B D1              10      POP DE
000253 BC1C C1              10      POP BC
       BC1D                     BDOS4IX:
000254 BC1D 3A3CBD          13      LD  A,(DE_MEM_SIZE)
000257 BC20 B7               4      OR  A
000258 BC21 2812            12      JR  Z,BDOS4
00025A BC23 C5              11      PUSH    BC
00025B BC24 D5              11      PUSH    DE
00025C BC25 E5              11      PUSH    HL
00025D BC26 4F               4      LD  C,A
00025E BC27 0600             7      LD  B,0
000260 BC29 21C8B8          10      LD  HL,ALT_MEM
000263 BC2C ED5B45BD        20      LD  DE,(SAVE_DE)
000267 BC30 EDB0                    LDIR
000269 BC32 E1              10      POP HL
00026A BC33 D1              10      POP DE
00026B BC34 C1              10      POP BC
       BC35                     BDOS4:
00026C BC35 3A4ABD          13      LD  A,(SAVE_HL+1)
00026F BC38 B7               4      OR  A
000270 BC39 2812            12      JR  Z,BDOS5
000272 BC3B C5              11      PUSH    BC
000273 BC3C D5              11      PUSH    DE
000274 BC3D E5              11      PUSH    HL
000275 BC3E 010B00          10      LD  BC,11
000278 BC41 2148B9          10      LD  HL,ALT_MEM3
00027B BC44 ED5B49BD        20      LD  DE,(SAVE_HL)
00027F BC48 EDB0                    LDIR
000281 BC4A E1              10      POP HL
000282 BC4B D1              10      POP DE
000283 BC4C C1              10      POP BC
       BC4D                     BDOS5:
000284 BC4D 3A44BD          13      LD  A,(SAVE_C)
000287 BC50 FE6F             7      CP  06FH        ;_DOSVER MSX-DOSのバージョン番号の獲得
000289 BC52 2013            12      JR  NZ,BDOS7
00028B BC54 04               4      INC B
00028C BC55 05               4      DEC B
00028D BC56 2802            12      JR  Z,S6F_1
00028F BC58 59               4      LD  E,C     ;DOS2の場合
000290 BC59 50               4      LD  D,B     ;MSXDOS2.SYSのバージョンをカーネルに合わす
       BC5A                     S6F_1:
000291 BC5A DD25            10      DEC IXH     ;NEXTOR判別
000293 BC5C 2807            12      JR  Z,NEXTOR
000295 BC5E DD21EDEC        14      LD  IX,0ECEDH   ;似非DOS判別用(INC IXがあるのでIXが0EDEDHになる)
000299 BC62 210100          10      LD  HL,VER_BCD  ;NEXTORじゃない場合はHLに似非DOSのバージョンが返る
       BC65                     NEXTOR:
00029C BC65 DD24            10      INC IXH
       BC67                     BDOS7:
00029E BC67 FE5B             7      CP  05BH        ;_PARSE パス名の解析
0002A0 BC69 2804            12      JR  Z,BDOS8
0002A2 BC6B FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
0002A4 BC6D 201E            12      JR  NZ,BDOS6
       BC6F                     BDOS8:
0002A6 BC6F 3A3CBD          13      LD  A,(DE_MEM_SIZE)
0002A9 BC72 2819            12      JR  Z,BDOS6
0002AB BC74 C5              11      PUSH    BC
0002AC BC75 01C8B8          10      LD  BC,ALT_MEM
0002AF BC78 ED42            15      SBC HL,BC       ;CF=0のハズ
0002B1 BC7A ED4B45BD        20      LD  BC,(SAVE_DE)
0002B5 BC7E 09              11      ADD HL,BC
0002B6 BC7F EB               4      EX  DE,HL
0002B7 BC80 01C8B8          10      LD  BC,ALT_MEM
0002BA BC83 A7               4      AND A       ;念のためにCF=0にする
0002BB BC84 ED42            15      SBC HL,BC
0002BD BC86 ED4B45BD        20      LD  BC,(SAVE_DE)
0002C1 BC8A 09              11      ADD HL,BC
0002C2 BC8B EB               4      EX  DE,HL
0002C3 BC8C C1              10      POP BC
       BC8D                     BDOS6:
0002C4 BC8D F1              10      POP AF
       BC8E                     S09X1:
0002C5 BC8E ED7B4BBD        20      LD  SP,(SAVE_SP)
0002C9 BC92 C9              10      RET
                                
       BC93                     CONST1:
0002CA BC93 0E0B             7      LD  C,0BH
0002CC BC95 C30500          10      JP  SYSTEM
       BC98                     CONIN1:
0002CF BC98 0E07             7      LD  C,7
0002D1 BC9A C30500          10      JP  SYSTEM
       BC9D                     CONOUT1:
0002D4 BC9D 59               4      LD  E,C
0002D5 BC9E 0E02             7      LD  C,2
0002D7 BCA0 C30500          10      JP  SYSTEM
                                
       BCA3                     _SYS09:     ;_STROUT 文字列出力
0002DA BCA3 1A               7      LD  A,(DE)
0002DB BCA4 13               6      INC DE
0002DC BCA5 FE24             7      CP  '$'
0002DE BCA7 28E5            12      JR  Z,S09X1
0002E0 BCA9 D5              11      PUSH    DE
0002E1 BCAA 0E02             7      LD  C,2
0002E3 BCAC 5F               4      LD  E,A
0002E4 BCAD CD7DF3          17      CALL    BDOS
0002E7 BCB0 D1              10      POP DE
0002E8 BCB1 18F0            12      JR  _SYS09
                                
       BCB3                     RDABS:
0002EA BCB3 3A43BD          13      LD  A,(_DTA+1)
0002ED BCB6 87               4      ADD A,A
0002EE BCB7 DAFBBB          10      JP  C,BDOS_EXEC
                                
0002F1 BCBA D5              11      PUSH    DE
0002F2 BCBB E5              11      PUSH    HL
0002F3 BCBC 11C8B8          10      LD  DE,BUF512
0002F6 BCBF 0E1A             7      LD  C,01AH      ;_SETDTA
0002F8 BCC1 CD7DF3          17      CALL    BDOS
0002FB BCC4 E1              10      POP HL
0002FC BCC5 D1              10      POP DE
                                
0002FD BCC6 ED4B42BD        20      LD  BC,(_DTA)
       BCCA                     RDABS1:
000301 BCCA D5              11      PUSH    DE
000302 BCCB E5              11      PUSH    HL
000303 BCCC C5              11      PUSH    BC
000304 BCCD 2601             7      LD  H,1
000306 BCCF 0E2F             7      LD  C,02FH      ;_RDABS
000308 BCD1 CD7DF3          17      CALL    BDOS
00030B BCD4 E1              10      POP HL      ;<=転送先
00030C BCD5 FEFF             7      CP  0FFH
00030E BCD7 2814            12      JR  Z,RDABS_ERR
000310 BCD9 EB               4      EX  DE,HL
000311 BCDA 21C8B8          10      LD  HL,BUF512
000314 BCDD 010002          10      LD  BC,512
000317 BCE0 EDB0                    LDIR
000319 BCE2 4B               4      LD  C,E
00031A BCE3 42               4      LD  B,D
00031B BCE4 E1              10      POP HL
00031C BCE5 D1              10      POP DE
00031D BCE6 13               6      INC DE
00031E BCE7 25               4      DEC H
00031F BCE8 20E0            12      JR  NZ,RDABS1
       BCEA                     WRABS_OK:
000321 BCEA AF               4      XOR A
       BCEB                     WRABS_ERR:
000322 BCEB D5              11      PUSH    DE
000323 BCEC E5              11      PUSH    HL
       BCED                     RDABS_ERR:
000324 BCED F5              11      PUSH    AF
000325 BCEE ED5B42BD        20      LD  DE,(_DTA)
000329 BCF2 0E1A             7      LD  C,01AH      ;_SETDTA
00032B BCF4 CD7DF3          17      CALL    BDOS
00032E BCF7 F1              10      POP AF
00032F BCF8 E1              10      POP HL
000330 BCF9 D1              10      POP DE
000331 BCFA ED7B4BBD        20      LD  SP,(SAVE_SP)
000335 BCFE C9              10      RET
                                
       BCFF                     WRABS:
000336 BCFF 3A43BD          13      LD  A,(_DTA+1)
000339 BD02 87               4      ADD A,A
00033A BD03 DAFBBB          10      JP  C,BDOS_EXEC
00033D BD06 D5              11      PUSH    DE
00033E BD07 E5              11      PUSH    HL
00033F BD08 11C8B8          10      LD  DE,BUF512
000342 BD0B 0E1A             7      LD  C,01AH      ;_SETDTA
000344 BD0D CD7DF3          17      CALL    BDOS
000347 BD10 E1              10      POP HL
000348 BD11 D1              10      POP DE
                                
000349 BD12 ED4B42BD        20      LD  BC,(_DTA)
       BD16                     WRABS1:
00034D BD16 D5              11      PUSH    DE
00034E BD17 E5              11      PUSH    HL
00034F BD18 69               4      LD  L,C
000350 BD19 60               4      LD  H,B
000351 BD1A 11C8B8          10      LD  DE,BUF512
000354 BD1D 010002          10      LD  BC,512
000357 BD20 EDB0                    LDIR
000359 BD22 E3              19      EX  (SP),HL
00035A BD23 D1              10      POP DE
                                
00035B BD24 D5              11      PUSH    DE
00035C BD25 E5              11      PUSH    HL
00035D BD26 2601             7      LD  H,1
00035F BD28 0E30             7      LD  C,030H      ;_WRABS
000361 BD2A CD7DF3          17      CALL    BDOS
000364 BD2D E1              10      POP HL
000365 BD2E D1              10      POP DE
000366 BD2F C1              10      POP BC
000367 BD30 FEFF             7      CP  0FFH
000369 BD32 28B7            12      JR  Z,WRABS_ERR
00036B BD34 13               6      INC DE
00036C BD35 25               4      DEC H
00036D BD36 20DE            12      JR  NZ,WRABS1
00036F BD38 18B0            12      JR  WRABS_OK
                                
                                
       BD3A                     TERMCODE:
000371 BD3A 00                      DB  0
       BD3B                     SAVE_A:
000372 BD3B 00                      DB  0
       BD3C                     DE_MEM_SIZE:
000373 BD3C 0000                    DW  0
       BD3E                     EXTSP:
000375 BD3E 0000                    DW  0
       BD40                     DEFAB:
000377 BD40 0000                    DW  0
       BD42                     _DTA:
000379 BD42 0000                    DW  0
       BD44                     SAVE_C:
00037B BD44 00                      DB  0
       BD45                     SAVE_DE:
00037C BD45 0000                    DW  0
       BD47                     SAVE_IX:
00037E BD47 0000                    DW  0
       BD49                     SAVE_HL:
000380 BD49 0000                    DW  0
       BD4B                     SAVE_SP:
000382 BD4B 0000                    DW  0
       BD4D                     MAJOR_VER:
000384 BD4D 00                      DB  0
[EOF:DOS.ASM:UTF_8]
                                    INCLUDE "CMD.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       BD4E                     _CMD:
000385 BD4E F3               4      DI
000386 BD4F CD644C          17      CALL    FRMEVL
000389 BD52 E5              11      PUSH    HL
00038A BD53 ED730FC0        20      LD  (BASSP),SP
00038E BD57 21C0FF          10      LD  HL,-64
000391 BD5A 39              11      ADD HL,SP
000392 BD5B F9               6      LD  SP,HL
                                
000393 BD5C CDD067          17      CALL    FRESTR
000396 BD5F 0600             7      LD  B,0
000398 BD61 4E               7      LD  C,(HL)
000399 BD62 23               6      INC HL
00039A BD63 7E               7      LD  A,(HL)
00039B BD64 23               6      INC HL
00039C BD65 66               7      LD  H,(HL)
00039D BD66 6F               4      LD  L,A
00039E BD67 11EDB8          10      LD  DE,BUFSTR
0003A1 BD6A 79               4      LD  A,C
0003A2 BD6B B7               4      OR  A
0003A3 BD6C CA59BE          10      JP  Z,WBOOT1
0003A6 BD6F EDB0                    LDIR
0003A8 BD71 AF               4      XOR A
0003A9 BD72 12               7      LD  (DE),A
                                
0003AA BD73 3A41F3          13      LD  A,(RAMAD0)
0003AD BD76 CDB2BF          17      CALL    ENASLT_00H  ;ページ0をRAMに切り替える
0003B0 BD79 3A42F3          13      LD  A,(RAMAD1)
0003B3 BD7C 2640             7      LD  H,040H
0003B5 BD7E CD2400          17      CALL    _ENASLT     ;ページ1をRAMに切り替える
                                
0003B8 BD81 21C8B8          10      LD  HL,FDRV
0003BB BD84 0625             7      LD  B,37
0003BD BD86 AF               4      XOR A
       BD87                     ZERO_FCB:
0003BE BD87 77               7      LD  (HL),A
0003BF BD88 23               6      INC HL
0003C0 BD89 10FC            13      DJNZ    ZERO_FCB
                                
0003C2 BD8B 11EDB8          10      LD  DE,BUFSTR
0003C5 BD8E CD7FBE          17      CALL    FILE
0003C8 BD91 D5              11      PUSH    DE
                                
0003C9 BD92 3A4DBD          13      LD  A,(MAJOR_VER)
0003CC BD95 FE02             7      CP  2
0003CE BD97 3035            12      JR  NC,DOS2_READ
0003D0 BD99 11C8B8          10      LD  DE,FDRV
0003D3 BD9C 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン(_FOPEN)
0003D5 BD9E CD0500          17      CALL    SYSTEM
0003D8 BDA1 3C               4      INC A
0003D9 BDA2 D1              10      POP DE
0003DA BDA3 CA59BE          10      JP  Z,WBOOT1
0003DD BDA6 D5              11      PUSH    DE
                                
0003DE BDA7 210100          10      LD  HL,1
0003E1 BDAA 22D6B8          16      LD  (FDRV+14),HL
0003E4 BDAD 6C               4      LD  L,H
0003E5 BDAE 22E9B8          16      LD  (FDRV+33),HL
0003E8 BDB1 22EBB8          16      LD  (FDRV+35),HL
                                
0003EB BDB4 110001          10      LD  DE,00100H
0003EE BDB7 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
0003F0 BDB9 CD0500          17      CALL    SYSTEM
                                
0003F3 BDBC 21C5B7          10      LD  HL,BDOS0-00100H
0003F6 BDBF 11C8B8          10      LD  DE,FDRV
0003F9 BDC2 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0003FB BDC4 CD0500          17      CALL    SYSTEM
0003FE BDC7 3D               4      DEC A
0003FF BDC8 D1              10      POP DE
000400 BDC9 C259BE          10      JP  NZ,WBOOT1
000403 BDCC 1832            12      JR  SET_PARAM
       BDCE                     DOS2_READ:
000405 BDCE 1A               7      LD  A,(DE)
000406 BDCF F5              11      PUSH    AF
000407 BDD0 AF               4      XOR A
000408 BDD1 12               7      LD  (DE),A
000409 BDD2 21E0BF          10      LD  HL,N_PROGRAM
00040C BDD5 11EDB8          10      LD  DE,BUFSTR
00040F BDD8 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000411 BDDA CD0500          17      CALL    SYSTEM
000414 BDDD 11EDB8          10      LD  DE,BUFSTR
000417 BDE0 0E43             7      LD  C,043H      ;(BDOS)ファイルハンドルのオープン
000419 BDE2 CD0500          17      CALL    SYSTEM
00041C BDE5 E1              10      POP HL
00041D BDE6 B7               4      OR  A
00041E BDE7 D1              10      POP DE
00041F BDE8 206F            12      JR  NZ,WBOOT1
000421 BDEA 7C               4      LD  A,H
000422 BDEB 12               7      LD  (DE),A
000423 BDEC D5              11      PUSH    DE
000424 BDED C5              11      PUSH    BC
000425 BDEE 110001          10      LD  DE,00100H
000428 BDF1 21C5B7          10      LD  HL,BDOS0-00100H
00042B BDF4 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し
00042D BDF6 CD0500          17      CALL    SYSTEM
000430 BDF9 C1              10      POP BC
000431 BDFA 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ
000433 BDFC CD0500          17      CALL    SYSTEM
000436 BDFF D1              10      POP DE
       BE00                     SET_PARAM:
000437 BE00 215C00          10      LD  HL,FCB1
       BE03                     ZERO1:
00043A BE03 74               7      LD  (HL),H
00043B BE04 2C               4      INC L
00043C BE05 20FC            12      JR  NZ,ZERO1
                                
00043E BE07 0600             7      LD  B,0
000440 BE09 218100          10      LD  HL,DTA1+1
       BE0C                     PARAM1:
000443 BE0C 1A               7      LD  A,(DE)
000444 BE0D 77               7      LD  (HL),A
000445 BE0E B7               4      OR  A
000446 BE0F 2805            12      JR  Z,PARAM2
000448 BE11 13               6      INC DE
000449 BE12 23               6      INC HL
00044A BE13 04               4      INC B
00044B BE14 18F6            12      JR  PARAM1
       BE16                     PARAM2:
00044D BE16 78               4      LD  A,B
00044E BE17 328000          13      LD  (DTA1),A
                                
000451 BE1A 118100          10      LD  DE,DTA1+1
000454 BE1D CD7FBE          17      CALL    FILE
000457 BE20 D5              11      PUSH    DE
000458 BE21 21C8B8          10      LD  HL,FDRV
00045B BE24 115C00          10      LD  DE,FCB1
00045E BE27 011000          10      LD  BC,00010H
000461 BE2A EDB0                    LDIR
000463 BE2C D1              10      POP DE
000464 BE2D 216C00          10      LD  HL,FCB2
000467 BE30 CD7FBE          17      CALL    FILE
00046A BE33 21C8B8          10      LD  HL,FDRV
00046D BE36 116C00          10      LD  DE,FCB2
000470 BE39 011000          10      LD  BC,00010H
000473 BE3C EDB0                    LDIR
000475 BE3E 3A4DBD          13      LD  A,(MAJOR_VER)
000478 BE41 FE02             7      CP  2
00047A BE43 380B            12      JR  C,DOS1_PARAM
00047C BE45 21E8BF          10      LD  HL,N_PARAMETERS
00047F BE48 118100          10      LD  DE,DTA1+1
000482 BE4B 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000484 BE4D CD0500          17      CALL    SYSTEM
       BE50                     DOS1_PARAM:
000487 BE50 210000          10      LD  HL,0
00048A BE53 2240BD          16      LD  (DEFAB),HL
00048D BE56 CD0001          17      CALL    00100H
       BE59                     WBOOT1:
000490 BE59 ED7B0FC0        20      LD  SP,(BASSP)
000494 BE5D 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
000497 BE60 CDB2BF          17      CALL    ENASLT_00H  ;ページ0をROMに切り替える
00049A BE63 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
00049D BE66 2640             7      LD  H,040H
00049F BE68 CD2400          17      CALL    _ENASLT     ;ページ1をROMに切り替える
0004A2 BE6B E1              10      POP HL
0004A3 BE6C FB               4      EI
0004A4 BE6D C9              10      RET
                                
       BE6E                     FILED2:             ;DOS2
0004A5 BE6E 0E5B             7      LD  C,05BH      ;(BDOS) パス名の解析
0004A7 BE70 CD0500          17      CALL    SYSTEM
0004AA BE73 79               4      LD  A,C
0004AB BE74 32C8B8          13      LD  (FDRV),A
0004AE BE77 21C9B8          10      LD  HL,FNAME
0004B1 BE7A 0E5C             7      LD  C,05CH      ;(BDOS) ファイル名の解析
0004B3 BE7C C30500          10      JP  SYSTEM
       BE7F                     FILE:
0004B6 BE7F 3A4DBD          13      LD  A,(MAJOR_VER)   ;Tablacus Disk ROM Lite
0004B9 BE82 FE01             7      CP  1
0004BB BE84 283E            12      JR  Z,FILE_TDRL
0004BD BE86 FE02             7      CP  2
0004BF BE88 30E4            12      JR  NC,FILED2
       BE8A                     FILEX:
0004C1 BE8A AF               4      XOR A
0004C2 BE8B 32C8B8          13      LD  (FDRV),A
0004C5 BE8E 67               4      LD  H,A
0004C6 BE8F 6F               4      LD  L,A
0004C7 BE90 22D6B8          16      LD  (FDRV+14),HL
0004CA BE93 CD47BF          17      CALL    SPCUT
0004CD BE96 CD2CBF          17      CALL    CCHK3
0004D0 BE99 2812            12      JR  Z,DEVI1
0004D2 BE9B 13               6      INC DE
0004D3 BE9C 1A               7      LD  A,(DE)
0004D4 BE9D 1B               6      DEC DE
0004D5 BE9E FE3A             7      CP  ':'
0004D7 BEA0 200B            12      JR  NZ,DEVI1
0004D9 BEA2 1A               7      LD  A,(DE)      ;DRIVE
0004DA BEA3 CD5ABF          17      CALL    CAP
0004DD BEA6 D640             7      SUB '@'
0004DF BEA8 13               6      INC DE
0004E0 BEA9 13               6      INC DE
0004E1 BEAA 32C8B8          13      LD  (FDRV),A
       BEAD                     DEVI1:
0004E4 BEAD 1A               7      LD  A,(DE)
0004E5 BEAE D65C             7      SUB 05CH        ;\
0004E7 BEB0 2009            12      JR  NZ,NOROOT
0004E9 BEB2 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0004EA BEB3 22E2B8          16      LD  (FDRV+26),HL
0004ED BEB6 2C               4      INC L
0004EE BEB7 22D6B8          16      LD  (FDRV+14),HL
0004F1 BEBA 13               6      INC DE
       BEBB                     NOROOT:
                                
       BEBB                     SETDIR:
0004F2 BEBB CDCCBE          17      CALL    FILED
0004F5 BEBE 1A               7      LD  A,(DE)
0004F6 BEBF FE5C             7      CP  05CH        ;\
0004F8 BEC1 C0              11      RET NZ
0004F9 BEC2 13               6      INC DE
       BEC3                     SETDIR1:
0004FA BEC3 C9              10      RET
                                
       BEC4                     FILE_TDRL:
0004FB BEC4 21C8B8          10      LD  HL,FDRV
0004FE BEC7 0E29             7      LD  C,029H      ;(BDOS) パス名の解析
000500 BEC9 C30500          10      JP  SYSTEM
                                
       BECC                     FILED:
000503 BECC CD13BF          17      CALL    FILEI
                                
000506 BECF 0608             7      LD  B,8
       BED1                     FILE2:
000508 BED1 CD21BF          17      CALL    CCHKF
00050B BED4 C8              11      RET Z
00050C BED5 FE2A             7      CP  '*'
00050E BED7 282E            12      JR  Z,FILE9
000510 BED9 FE2E             7      CP  '.'
000512 BEDB 280C            12      JR  Z,FILE4
000514 BEDD 77               7      LD  (HL),A
000515 BEDE 23               6      INC HL
000516 BEDF 10F0            13      DJNZ    FILE2
                                
       BEE1                     FILE3:
000518 BEE1 CD21BF          17      CALL    CCHKF
00051B BEE4 C8              11      RET Z
00051C BEE5 FE2E             7      CP  '.'
00051E BEE7 20F8            12      JR  NZ,FILE3
                                
       BEE9                     FILE4:
000520 BEE9 21D1B8          10      LD  HL,FNAME+8
000523 BEEC 0603             7      LD  B,3
                                
       BEEE                     FILE4L:
000525 BEEE CD21BF          17      CALL    CCHKF
000528 BEF1 C8              11      RET Z
000529 BEF2 FE2E             7      CP  '.'
00052B BEF4 2008            12      JR  NZ,FILE12
00052D BEF6 32C9B8          13      LD  (FNAME),A   ;Parent directory(..)
000530 BEF9 32CAB8          13      LD  (FNAME+1),A
000533 BEFC 3E20             7      LD  A,020H
       BEFE                     FILE12:
000535 BEFE FE2A             7      CP  '*'
000537 BF00 280A            12      JR  Z,FILE10
000539 BF02 77               7      LD  (HL),A
00053A BF03 23               6      INC HL
00053B BF04 10E8            13      DJNZ    FILE4L
00053D BF06 C9              10      RET
                                
       BF07                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00053E BF07 CD0CBF          17      CALL    FILE10
000541 BF0A 18D5            12      JR  FILE3
                                
       BF0C                     FILE10:
000543 BF0C 3E3F             7      LD  A,'?'
                                
       BF0E                     FILL_MEMORY:                ;HLからBバイトAで埋める
000545 BF0E 77               7      LD  (HL),A
000546 BF0F 23               6      INC HL
000547 BF10 10FC            13      DJNZ    FILL_MEMORY
000549 BF12 C9              10      RET
                                
       BF13                     FILEI:              ;名前＋拡張子をスペースで初期化
00054A BF13 3E20             7      LD  A,020H
00054C BF15 01000B          10      LD  BC,11*256
00054F BF18 21C9B8          10      LD  HL,FNAME
000552 BF1B E5              11      PUSH    HL
000553 BF1C CD0EBF          17      CALL    FILL_MEMORY
000556 BF1F E1              10      POP HL
000557 BF20 C9              10      RET
                                
       BF21                     CCHKF:
000558 BF21 1A               7      LD  A,(DE)
000559 BF22 CD29BF          17      CALL    CCHK2
00055C BF25 C8              11      RET Z
00055D BF26 C37CBF          10      JP  FKAN
                                
       BF29                     CCHK2:
000560 BF29 0C               4      INC C
000561 BF2A 0D               4      DEC C
000562 BF2B C0              11      RET NZ
       BF2C                     CCHK3:              ;ZF=1 で使えない文字
000563 BF2C FE2B             7      CP  '+'
000565 BF2E C8              11      RET Z
000566 BF2F FE2C             7      CP  ','
000568 BF31 C8              11      RET Z
000569 BF32 FE2F             7      CP  '/'
00056B BF34 C8              11      RET Z
00056C BF35 FE3A             7      CP  ':'
00056E BF37 C8              11      RET Z
00056F BF38 FE3B             7      CP  ';'
000571 BF3A C8              11      RET Z
000572 BF3B FE3D             7      CP  '='
000574 BF3D C8              11      RET Z
000575 BF3E FE5C             7      CP  05CH    ;\
000577 BF40 C8              11      RET Z
000578 BF41 FE20             7      CP  020H
00057A BF43 D0              11      RET NC
00057B BF44 BF               4      CP  A       ;Z=1
00057C BF45 C9              10      RET
                                
       BF46                     SS1:
00057D BF46 13               6      INC DE
       BF47                     SPCUT:              ;スペースをカット
00057E BF47 1A               7      LD  A,(DE)
00057F BF48 FE20             7      CP  020H
000581 BF4A 28FA            12      JR  Z,SS1
000583 BF4C C9              10      RET
                                
       BF4D                     TOZERO:
000584 BF4D D5              11      PUSH    DE
       BF4E                     TZ1:
000585 BF4E 1A               7      LD  A,(DE)
000586 BF4F FE20             7      CP  20H
000588 BF51 3803            12      JR  C,TZ2
00058A BF53 13               6      INC DE
00058B BF54 18F8            12      JR  TZ1
       BF56                     TZ2:
00058D BF56 AF               4      XOR A
00058E BF57 12               7      LD  (DE),A
00058F BF58 D1              10      POP DE
000590 BF59 C9              10      RET
                                
       BF5A                     CAP:
000591 BF5A FE61             7      CP  'a'
000593 BF5C D8              11      RET C
000594 BF5D FE7B             7      CP  'z'+1
000596 BF5F D0              11      RET NC
000597 BF60 D620             7      SUB 020H
000599 BF62 C9              10      RET
       BF63                     CAP2:
00059A BF63 CD5ABF          17      CALL    CAP
       BF66                     CAP3:
00059D BF66 CD6FBF          17      CALL    CAP4
0005A0 BF69 FE21             7      CP  021H
0005A2 BF6B D0              11      RET NC
0005A3 BF6C 3E20             7      LD  A,020H
0005A5 BF6E C9              10      RET
       BF6F                     CAP4:
0005A6 BF6F FE05             7      CP  5
0005A8 BF71 C0              11      RET NZ
0005A9 BF72 3EE5             7      LD  A,0E5H
0005AB BF74 C9              10      RET
                                
       BF75                     FKANC:
0005AC BF75 CB41             8      BIT 0,C
0005AE BF77 CC63BF          17      CALL    Z,CAP2
0005B1 BF7A 1801            12      JR  FKANX
       BF7C                     FKAN:           ;漢字チェック
0005B3 BF7C 13               6      INC DE
       BF7D                     FKANX:
0005B4 BF7D CB41             8      BIT 0,C
0005B6 BF7F CB81             8      RES 0,C
0005B8 BF81 C0              11      RET NZ
0005B9 BF82 FE80             7      CP  080H
0005BB BF84 D8              11      RET C
0005BC BF85 FEA0             7      CP  0A0H
0005BE BF87 3803            12      JR  C,FKAN1
0005C0 BF89 FEE0             7      CP  0E0H
0005C2 BF8B D8              11      RET C
       BF8C                     FKAN1:
0005C3 BF8C 0C               4      INC C
0005C4 BF8D A7               4      AND A
0005C5 BF8E C9              10      RET
                                
       BF8F                     CHKWILDX:
0005C6 BF8F FDE5            15      PUSH    IY
0005C8 BF91 E1              10      POP HL
0005C9 BF92 23               6      INC HL
       BF93                     CHKWILD:
0005CA BF93 060B             7      LD  B,11
0005CC BF95 3E3F             7      LD  A,'?'
       BF97                     CHKWIL1:
0005CE BF97 BE               7      CP  (HL)
0005CF BF98 23               6      INC HL
0005D0 BF99 37               4      SCF
0005D1 BF9A C8              11      RET Z
0005D2 BF9B 10FA            13      DJNZ    CHKWIL1
0005D4 BF9D AF               4      XOR A
0005D5 BF9E C9              10      RET
                                
       BF9F                     CALSLT_BIOS:
0005D6 BF9F FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005DA BFA3 C31C00          10      JP  _CALSLT
                                
       BFA6                     INT38H_ROM:
0005DD BFA6 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
0005E0 BFA9 CDB2BF          17      CALL    ENASLT_00H
0005E3 BFAC CD3800          17      CALL    00038H
0005E6 BFAF 3A41F3          13      LD  A,(RAMAD0)  ;メインRAMに切り替える
                                ;   JP  ENASLT_00H
                                ;
                                ;ページ0専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
                                ; ページ2 に配置
       BFB2                     ENASLT_00H:
0005E9 BFB2 F3               4      DI
0005EA BFB3 67               4      LD  H,A
0005EB BFB4 E603             7      AND 3
0005ED BFB6 4F               4      LD  C,A
0005EE BFB7 DBA8            11      IN  A,(0A8H)
0005F0 BFB9 06FC             7      LD  B,0FCH  ;ページ0
0005F2 BFBB A0               4      AND B
0005F3 BFBC B1               4      OR  C
0005F4 BFBD CB7C             8      BIT 7,H
0005F6 BFBF CA23C1          10      JP  Z,ENASLT_NOEXT
                                                ;拡張スロットの処理
0005F9 BFC2 D5              11      PUSH    DE
0005FA BFC3 CD0BC1          17      CALL    ENATBL
0005FD BFC6 0F               4      RRCA
0005FE BFC7 0F               4      RRCA
0005FF BFC8 4F               4      LD  C,A
000600 BFC9 7B               4      LD  A,E
000601 BFCA CDD0BF          17      CALL    AT_3B
000604 BFCD 73               7      LD  (HL),E
000605 BFCE D1              10      POP DE
000606 BFCF C9              10      RET
                                ;
                                ;   ENASLOTの補助（ページ0・003BH～にも配置）
                                ;
       BFD0                     AT_3B:              ;ENASUB 対象の拡張スロットを切り替えるために基本スロットを切り替える
000607 BFD0 D3A8            11      OUT (0A8H),A
000609 BFD2 3AFFFF          13      LD  A,(0FFFFH)  ;拡張スロットの切り替え
00060C BFD5 2F               4      CPL
00060D BFD6 A0               4      AND B
00060E BFD7 B1               4      OR  C
00060F BFD8 32FFFF          13      LD  (0FFFFH),A
000612 BFDB 5F               4      LD  E,A
                                                ;基本スロットの切り替え
000613 BFDC 7A               4      LD  A,D
000614 BFDD D3A8            11      OUT (0A8H),A
000616 BFDF C9              10      RET
       BFE0                     AT_3B_E:
                                
       BFE0                     N_PROGRAM:
000617 BFE0 50524F4752414D00        DB  "PROGRAM",0
       BFE8                     N_PARAMETERS:
00061F BFE8 504152414D455445        DB  "PARAMETERS",0
            525300              
[EOF:CMD.ASM:UTF_8]
                                    INCLUDE "BIOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
00062A BFF3                         ALIGN   256 ;0C000Hに配置
                                ;           下位1バイト0になるように
       C000                     CPM_BOOT:
000637 C000 C359BE          10      JP  WBOOT1
       C003                     CPM_WBOOT:
00063A C003 C359BE          10      JP  WBOOT1
       C006                     CPM_CONST:          ;(BDOS)コンソール直接入力
00063D C006 C393BC          10      JP  CONST1
       C009                     CPM_CONIN:
000640 C009 C398BC          10      JP  CONIN1
       C00C                     CPM_CONOUT:
000643 C00C C39DBC          10      JP  CONOUT1
       C00F                     BASSP:
000646 C00F 0000                    DW  0
       C012                     BASIC_START2    EQU $+1
                                ;
                                ; インタースロットコール(DOS1専用)
                                ; ページ3 に配置
                                
                                ;
                                ;   現在のスロットを知る
                                ;in
                                ;HL←上位2ビットで切り替えるページを指定
                                ;out
                                ;A→スロット
       C011                     _GETSLT:
000648 C011 E5              11      PUSH    HL
000649 C012 DBA8            11      IN  A,(0A8H)
                                
00064B C014 CB7C             8      BIT 7,H
00064D C016 2032            12      JR  NZ,GETSLT_HIGH
00064F C018 CB74             8      BIT 6,H
000651 C01A 21C1FC          10      LD  HL,EXPTBL
000654 C01D 201B            12      JR  NZ,GETSLT_40H
       C01F                     GETSLT_00H:             ;ページ0
000656 C01F E603             7      AND 3
000658 C021 85               4      ADD A,L
000659 C022 6F               4      LD  L,A
00065A C023 CB7E            13      BIT 7,(HL)
00065C C025 280F            12      JR  Z,GETSLT_1
00065E C027 C604             7      ADD A,SLTTBL-EXPTBL     ;拡張スロットをワークアリアから取得
000660 C029 6F               4      LD  L,A
000661 C02A 7E               7      LD  A,(HL)
       C02B                     GETSLT_3:
000662 C02B 07               4      RLCA
000663 C02C 07               4      RLCA
       C02D                     GETSLT_2:
000664 C02D E60C             7      AND 00CH
000666 C02F 67               4      LD  H,A
000667 C030 7D               4      LD  A,L
000668 C031 D645             7      SUB LOW SLTTBL - 080H
00066A C033 B4               4      OR  H
00066B C034 E1              10      POP HL
00066C C035 C9              10      RET
       C036                     GETSLT_1:               ;スロットは拡張されていない
00066D C036 D6C1             7      SUB LOW EXPTBL
00066F C038 E1              10      POP HL
000670 C039 C9              10      RET
                                
       C03A                     GETSLT_40H:             ;ページ1
000671 C03A 0F               4      RRCA
000672 C03B 0F               4      RRCA
000673 C03C E603             7      AND 3
000675 C03E 85               4      ADD A,L
000676 C03F 6F               4      LD  L,A
000677 C040 CB7E            13      BIT 7,(HL)
000679 C042 28F2            12      JR  Z,GETSLT_1
00067B C044 C604             7      ADD A,SLTTBL-EXPTBL
00067D C046 6F               4      LD  L,A
00067E C047 7E               7      LD  A,(HL)
00067F C048 18E3            12      JR  GETSLT_2
                                
       C04A                     GETSLT_HIGH:
000681 C04A CB74             8      BIT 6,H
000683 C04C 21C1FC          10      LD  HL,EXPTBL
000686 C04F 2014            12      JR  NZ,GETSLT_C0H
       C051                     GETSLT_80H:             ;ページ2
000688 C051 0F               4      RRCA
000689 C052 0F               4      RRCA
00068A C053 0F               4      RRCA
00068B C054 0F               4      RRCA
00068C C055 E603             7      AND 3
00068E C057 85               4      ADD A,L
00068F C058 6F               4      LD  L,A
000690 C059 CB7E            13      BIT 7,(HL)
000692 C05B 28D9            12      JR  Z,GETSLT_1
000694 C05D C604             7      ADD A,SLTTBL-EXPTBL
000696 C05F 6F               4      LD  L,A
000697 C060 7E               7      LD  A,(HL)
000698 C061 0F               4      RRCA
000699 C062 0F               4      RRCA
00069A C063 18C8            12      JR  GETSLT_2
                                
       C065                     GETSLT_C0H:             ;ページ3
00069C C065 07               4      RLCA
00069D C066 07               4      RLCA
00069E C067 E603             7      AND 3
0006A0 C069 85               4      ADD A,L
0006A1 C06A 6F               4      LD  L,A
0006A2 C06B CB7E            13      BIT 7,(HL)
0006A4 C06D 28C7            12      JR  Z,GETSLT_1
0006A6 C06F C604             7      ADD A,SLTTBL-EXPTBL
0006A8 C071 6F               4      LD  L,A
0006A9 C072 7E               7      LD  A,(HL)
0006AA C073 07               4      RLCA
0006AB C074 07               4      RLCA
0006AC C075 18B4            12      JR  GETSLT_3
                                
       C077                     SAME_SLOT_00H:          ;ページ0とページ3のスロットが同一
0006AE C077 D3A8            11      OUT (0A8H),A
0006B0 C079 3AFFFF          13      LD  A,(0FFFFH)  ;拡張スロットの切り替え
0006B3 C07C 2F               4      CPL
0006B4 C07D E6FC             7      AND 0FCH        ;ページ0マスク
0006B6 C07F B1               4      OR  C
0006B7 C080 32FFFF          13      LD  (0FFFFH),A
0006BA C083 77               7      LD  (HL),A
0006BB C084 C9              10      RET
                                
       C085                     ENASLT_HIGH:
0006BC C085 CB74             8      BIT 6,H
0006BE C087 C0              11      RET NZ          ;ページ3はスロット切り替え不可
                                ;
                                ;ページ2専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
       C088                     ENASLT_80H:
0006BF C088 F3               4      DI
0006C0 C089 6F               4      LD  L,A
0006C1 C08A E603             7      AND 3
0006C3 C08C 07               4      RLCA
0006C4 C08D 07               4      RLCA
0006C5 C08E 07               4      RLCA
0006C6 C08F 07               4      RLCA
0006C7 C090 4F               4      LD  C,A
0006C8 C091 DBA8            11      IN  A,(0A8H)
0006CA C093 06CF             7      LD  B,0CFH  ;ページ2マスク
0006CC C095 A0               4      AND B
0006CD C096 B1               4      OR  C
0006CE C097 CB7D             8      BIT 7,L
0006D0 C099 CA23C1          10      JP  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
0006D3 C09C D5              11      PUSH    DE
0006D4 C09D CD01C1          17      CALL    ENATBL_BIOS_CHECK
0006D7 C0A0 07               4      RLCA
0006D8 C0A1 07               4      RLCA
0006D9 C0A2 4F               4      LD  C,A
0006DA C0A3 7B               4      LD  A,E
0006DB C0A4 CD3B00          17      CALL    ENASUB
0006DE C0A7 73               7      LD  (HL),E
0006DF C0A8 D1              10      POP DE
0006E0 C0A9 C9              10      RET
                                ;
                                ;ENASLT
                                ;in
                                ;A←スロット
                                ;HL←上位2ビットで切り替えるページを指定
                                ;破壊
                                ;ABCHL
                                ;
       C0AA                     ENASLT:
0006E1 C0AA CB7C             8      BIT 7,H
0006E3 C0AC 20D7            12      JR  NZ,ENASLT_HIGH
0006E5 C0AE CB74             8      BIT 6,H
0006E7 C0B0 2074            12      JR  NZ,ENASLT_40H
       C0B2                     _ENASLT_00H:
0006E9 C0B2 F3               4      DI
0006EA C0B3 67               4      LD  H,A
0006EB C0B4 E603             7      AND 3
0006ED C0B6 4F               4      LD  C,A
0006EE C0B7 DBA8            11      IN  A,(0A8H)
0006F0 C0B9 E6FC             7      AND 0FCH    ;ページ0マスク
0006F2 C0BB B1               4      OR  C
0006F3 C0BC CB7C             8      BIT 7,H
0006F5 C0BE 2863            12      JR  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
0006F7 C0C0 D5              11      PUSH    DE
0006F8 C0C1 44               4      LD  B,H
0006F9 C0C2 CD0BC1          17      CALL    ENATBL
0006FC C0C5 0F               4      RRCA
0006FD C0C6 0F               4      RRCA
0006FE C0C7 4F               4      LD  C,A
0006FF C0C8 7B               4      LD  A,E
000700 C0C9 BA               4      CP  D
000701 C0CA D1              10      POP DE
000702 C0CB 28AA            12      JR  Z,SAME_SLOT_00H ;ページ0とページ3のスロットが同一の場合
000704 C0CD 60               4      LD  H,B
       C0CE                     ENASLT_SUB:
000705 C0CE 7C               4      LD  A,H     ;ページ3でスロットを指定するためにページ2のルーチンを使う
000706 C0CF DDE5            15      PUSH    IX
000708 C0D1 DD21B2BF        14      LD  IX,ENASLT_00H
       C0D5                     INT38H_SUB1:
00070C C0D5 FDE5            15      PUSH    IY
00070E C0D7 FD2A42F3        20      LD  IY,(RAMAD2-1)
000712 C0DB CD53C1          17      CALL    CALSLT
000715 C0DE FDE1            14      POP IY
000717 C0E0 DDE1            14      POP IX
000719 C0E2 C9              10      RET
                                
       C0E3                     _ENASLT_00H_S:
00071A C0E3 ED73EFC0        20      LD  (ENASLT_SP1),SP
00071E C0E7 ED7B0FC0        20      LD  SP,(BASSP)
000722 C0EB CDCEC0          17      CALL    ENASLT_SUB
000725 C0EE 310000          10      LD  SP,0
       C0EF                     ENASLT_SP1  EQU $-2
000728 C0F1 C9              10      RET
                                
       C0F2                     INT38H_SUB:
000729 C0F2 DDE5            15      PUSH    IX
00072B C0F4 DD21A6BF        14      LD  IX,INT38H_ROM
00072F C0F8 18DB            12      JR  INT38H_SUB1
                                
       C0FA                     ENASLT_BIOS:
000731 C0FA D1              10      POP DE
000732 C0FB 7D               4      LD  A,L
000733 C0FC CD2400          17      CALL    _ENASLT
000736 C0FF D1              10      POP DE
000737 C100 C9              10      RET
                                
       C101                     ENATBL_BIOS_CHECK:
000738 C101 57               4      LD  D,A
000739 C102 3A0000          13      LD  A,(0000H)
00073C C105 FEF3             7      CP  0F3H    ;0000H が DI の場合はページ0は BIOS とみなす
00073E C107 28F1            12      JR  Z,ENASLT_BIOS
000740 C109 65               4      LD  H,L
000741 C10A 7A               4      LD  A,D
       C10B                     ENATBL:
000742 C10B 57               4      LD  D,A ;基本スロットに出力する値
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
000743 C10C 7C               4      LD  A,H
000744 C10D E603             7      AND 3
000746 C10F 4F               4      LD  C,A ;C=スロット#
                                
                                    ;スロットテーブル
000747 C110 2EC5             7      LD  L,LOW SLTTBL
000749 C112 85               4      ADD A,L
00074A C113 6F               4      LD  L,A
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
00074B C114 79               4      LD  A,C ;C=スロット#
00074C C115 0F               4      RRCA
00074D C116 0F               4      RRCA        ;ページ3
00074E C117 4F               4      LD  C,A
00074F C118 7A               4      LD  A,D ;基本スロットに出力する値
000750 C119 E63F             7      AND 03FH    ;ページ3マスク
000752 C11B B1               4      OR  C
000753 C11C 5F               4      LD  E,A ;基本スロットでページ3にスロットを割り当てる
000754 C11D 7C               4      LD  A,H
000755 C11E E60C             7      AND 00CH
000757 C120 26FC             7      LD  H,HIGH SLTTBL
000759 C122 C9              10      RET
       C123                     ENASLT_NOEXT_00H:
                                
       C123                     ENASLT_NOEXT:               ;スロットが拡張されていない場合
00075A C123 D3A8            11      OUT (0A8H),A
00075C C125 C9              10      RET
                                
                                ;
                                ;ページ1専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
       C126                     ENASLT_40H:
00075D C126 F3               4      DI
00075E C127 6F               4      LD  L,A
00075F C128 E603             7      AND 3
000761 C12A 07               4      RLCA
000762 C12B 07               4      RLCA
000763 C12C 4F               4      LD  C,A
000764 C12D DBA8            11      IN  A,(0A8H)
000766 C12F 06F3             7      LD  B,0F3H  ;ページ1マスク
000768 C131 A0               4      AND B
000769 C132 B1               4      OR  C
00076A C133 CB7D             8      BIT 7,L
00076C C135 28EC            12      JR  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
00076E C137 D5              11      PUSH    DE
00076F C138 CD01C1          17      CALL    ENATBL_BIOS_CHECK
000772 C13B 4F               4      LD  C,A
000773 C13C 7B               4      LD  A,E
000774 C13D CD3B00          17      CALL    ENASUB
000777 C140 73               7      LD  (HL),E
000778 C141 D1              10      POP DE
000779 C142 C9              10      RET
                                
       C143                     CALLF:
00077A C143 E3              19      EX  (SP),HL
00077B C144 F5              11      PUSH    AF
00077C C145 7E               7      LD  A,(HL)
00077D C146 FD67             9      LD  IYH,A
00077F C148 23               6      INC HL
000780 C149 7E               7      LD  A,(HL)
000781 C14A DD6F             9      LD  IXL,A
000783 C14C 23               6      INC HL
000784 C14D 7E               7      LD  A,(HL)
000785 C14E DD67             9      LD  IXH,A
000787 C150 23               6      INC HL
000788 C151 F1              10      POP AF
000789 C152 E3              19      EX  (SP),HL
       C153                     CALSLT:
00078A C153 F3               4      DI
00078B C154 08               4      EX  AF,AF'
00078C C155 F5              11      PUSH    AF      ;裏AFを保存
00078D C156 E5              11      PUSH    HL
00078E C157 210280          10      LD  HL,08002H
000791 C15A 39              11      ADD HL,SP
000792 C15B E1              10      POP HL
000793 C15C 3007            12      JR  NC,CALSLT_1
000795 C15E CD75C1          17      CALL    CALSLT_2
       C161                     CALSLT_E:
000798 C161 08               4      EX  AF,AF'
000799 C162 F1              10      POP AF      ;保存した裏AF
00079A C163 08               4      EX  AF,AF'
00079B C164 C9              10      RET
       C165                     CALSLT_1:
00079C C165 ED7371C1        20      LD  (CSSP),SP
0007A0 C169 ED7B0FC0        20      LD  SP,(BASSP)
0007A4 C16D CD75C1          17      CALL    CALSLT_2
0007A7 C170 310000          10      LD  SP,0
       C171                     CSSP    EQU $-2
0007AA C173 18EC            12      JR  CALSLT_E
                                
       C175                     CALSLT_2:
0007AC C175 E5              11      PUSH    HL
0007AD C176 DD7C             9      LD  A,IXH
0007AF C178 67               4      LD  H,A
0007B0 C179 CD11C0          17      CALL    _GETSLT
0007B3 C17C FDBC            10      CP  IYH
0007B5 C17E 281E            12      JR  Z,CALSLT_3
0007B7 C180 C5              11      PUSH    BC
0007B8 C181 F5              11      PUSH    AF
0007B9 C182 FD7C             9      LD  A,IYH
0007BB C184 CDAAC0          17      CALL    ENASLT
0007BE C187 F1              10      POP AF
0007BF C188 C1              10      POP BC
0007C0 C189 6F               4      LD  L,A
0007C1 C18A DD7C             9      LD  A,IXH
0007C3 C18C 67               4      LD  H,A
0007C4 C18D E3              19      EX  (SP),HL
0007C5 C18E 08               4      EX  AF,AF'
0007C6 C18F CD98F3          17      CALL    JP_IX
0007C9 C192 E3              19      EX  (SP),HL
0007CA C193 C5              11      PUSH    BC
0007CB C194 08               4      EX  AF,AF'
0007CC C195 7D               4      LD  A,L
0007CD C196 CDAAC0          17      CALL    ENASLT
0007D0 C199 08               4      EX  AF,AF'
0007D1 C19A C1              10      POP BC
0007D2 C19B E1              10      POP HL
0007D3 C19C FB               4      EI
0007D4 C19D C9              10      RET
                                
       C19E                     CALSLT_3:
0007D5 C19E E1              10      POP HL
0007D6 C19F 08               4      EX  AF,AF'
0007D7 C1A0 DDE9             8      JP  (IX)
                                
       C1A2                     RDSLT:
0007D9 C1A2 F3               4      DI
0007DA C1A3 D5              11      PUSH    DE
0007DB C1A4 57               4      LD  D,A
0007DC C1A5 CD11C0          17      CALL    _GETSLT
0007DF C1A8 BA               4      CP  D
0007E0 C1A9 2812            12      JR  Z,RDSLT1
0007E2 C1AB 5F               4      LD  E,A
0007E3 C1AC 7A               4      LD  A,D
0007E4 C1AD E5              11      PUSH    HL
0007E5 C1AE CDAAC0          17      CALL    ENASLT
0007E8 C1B1 E1              10      POP HL
0007E9 C1B2 46               7      LD  B,(HL)
0007EA C1B3 C5              11      PUSH    BC
0007EB C1B4 7B               4      LD  A,E
0007EC C1B5 E5              11      PUSH    HL
0007ED C1B6 CDAAC0          17      CALL    ENASLT
0007F0 C1B9 E1              10      POP HL
0007F1 C1BA F1              10      POP AF
0007F2 C1BB D1              10      POP DE
0007F3 C1BC C9              10      RET
       C1BD                     RDSLT1:
0007F4 C1BD 7E               7      LD  A,(HL)
0007F5 C1BE D1              10      POP DE
0007F6 C1BF C9              10      RET
                                
       C1C0                     WRSLT:
0007F7 C1C0 F3               4      DI
0007F8 C1C1 D5              11      PUSH    DE
0007F9 C1C2 57               4      LD  D,A
0007FA C1C3 CD11C0          17      CALL    _GETSLT
0007FD C1C6 BA               4      CP  D
0007FE C1C7 2810            12      JR  Z,WRSLT1
000800 C1C9 F5              11      PUSH    AF
000801 C1CA E5              11      PUSH    HL
000802 C1CB 7A               4      LD  A,D
000803 C1CC CDAAC0          17      CALL    ENASLT
000806 C1CF E1              10      POP HL
000807 C1D0 73               7      LD  (HL),E
000808 C1D1 F1              10      POP AF
000809 C1D2 E5              11      PUSH    HL
00080A C1D3 CDAAC0          17      CALL    ENASLT
00080D C1D6 E1              10      POP HL
00080E C1D7 D1              10      POP DE
00080F C1D8 C9              10      RET
                                
       C1D9                     WRSLT1:
000810 C1D9 73               7      LD  (HL),E
000811 C1DA D1              10      POP DE
000812 C1DB C9              10      RET
                                
       C1DC                     INT38H:
000813 C1DC F3               4      DI
000814 C1DD F5              11      PUSH    AF
000815 C1DE C5              11      PUSH    BC
000816 C1DF E5              11      PUSH    HL
000817 C1E0 210280          10      LD  HL,08002H
00081A C1E3 39              11      ADD HL,SP
00081B C1E4 380F            12      JR  C,INT38H1
00081D C1E6 ED73F2C1        20      LD  (INTSP),SP  ;スタックポインタ保存
000821 C1EA ED7B0FC0        20      LD  SP,(BASSP)
000825 C1EE CDF2C0          17      CALL    INT38H_SUB
000828 C1F1 310000          10      LD  SP,0
       C1F2                     INTSP   EQU $-2
00082B C1F4 AF               4      XOR A
       C1F5                     INT38H1:
00082C C1F5 DCF2C0          17      CALL    C,INT38H_SUB
00082F C1F8 E1              10      POP HL
000830 C1F9 C1              10      POP BC
000831 C1FA F1              10      POP AF
000832 C1FB FB               4      EI
000833 C1FC C9              10      RET
[EOF:BIOS.ASM:UTF_8]
       C1FD                     LAST:
[EOF:DOSCMD.ASM:UTF_8]
