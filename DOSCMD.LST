                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   Tablacus DOS call for MSX
                                ;   Gaku
                                
                                    INCLUDE "DEF.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       0001                     VER_BCD EQU 00001H
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       0402                     MAPPER  EQU 00402H
                                
       F307                     FCB11   EQU 0F307H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F398                     JP_IX   EQU 0F398H
       F389                     ENASLT_NOEXT    EQU 0F389H
       F3AF                     LINL32  EQU 0F3AFH
       F3AE                     LINL40  EQU 0F3AEH
       F3B0                     LINLEN  EQU 0F3B0H
                                
       F41F                     KBUF    EQU 0F41FH; 318
       F55E                     BUF EQU 0F55EH; 258
                                
       F662                     DIMFLG  EQU 0F662H
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F676                     TXTTAB  EQU 0F676H
       F6A7                     TEMP    EQU 0F6A7H
       F6AF                     SAVTXT  EQU 0F6AFH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6B5                     DOT EQU 0F6B5H
       F6B9                     ONELIN  EQU 0F6B9H
                                
       F7F6                     DAC EQU 0F7F6H
       F7F8                     DACDAT  EQU DAC+2
                                
       FAF8                     EXBRSA  EQU 0FAF8H
                                
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCC5                     SLTTBL  EQU 0FCC5H
                                
       FE0D                     H_CMD   EQU 0FE0DH
                                
       FFCA                     EXTBIOS EQU 0FFCAH
                                
       B9C0                     START   EQU 0B9C0H
                                
       B8BB                     BUF512  EQU TERM-512+3  ;_RDABS _WRABS のバッファ
       B8B8                     BDOS0   EQU BUF512-3
       B8BB                     ALT_MEM EQU BUF512
       B8FB                     ALT_MEM2    EQU ALT_MEM+64
       B93B                     ALT_MEM3    EQU ALT_MEM2+64
       B8BB                     FDRV    EQU BUF512
       B8BC                     FNAME   EQU BUF512+1
       B8E0                     BUFSTR  EQU BUF512+37
                                
       8001                     BASIC_DEF   EQU 08001H
       C201                     BASIC_START1    EQU 0C201H
       003B                     ENASUB  EQU 0003BH
[EOF:DEF.ASM:UTF_8]
                                
000000 B9B9                         ORG START-7
                                
                                ;   MSX BINARY HEADER
000000 B9B9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 B9BA C0B9                    DW  START
                                ;   MSX BINARY END ADDRESS
000003 B9BC FFC1                    DW  LAST
                                ;   MSX BINARY EXEC ADDRESS
000005 B9BE C0B9                    DW  START
                                
000007 B9C0                         ORG START
                                
                                    INCLUDE "INIT.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
000007 B9C0 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
000009 B9C2 CD7DF3          17      CALL    BDOS
00000C B9C5 78               4      LD  A,B
00000D B9C6 323CBD          13      LD  (MAJOR_VER),A
000010 B9C9 21918A          10      LD  HL,08A91H
000013 B9CC ED52            15      SBC HL,DE
000015 B9CE 2005            12      JR  NZ,NOTABLACUS
000017 B9D0 3E01             7      LD  A,1
000019 B9D2 323CBD          13      LD  (MAJOR_VER),A
       B9D5                     NOTABLACUS:
                                                    ;BASICのフリーエリア位置をずらす
00001C B9D5 2101C2          10      LD  HL,BASIC_START1
00001F B9D8 B7               4      OR  A
000020 B9D9 2803            12      JR  Z,DOS1START
000022 B9DB 212AC0          10      LD  HL,BASIC_START2
       B9DE                     DOS1START:
000025 B9DE 2276F6          16      LD  (TXTTAB),HL
000028 B9E1 AF               4      XOR A
000029 B9E2 77               7      LD  (HL),A
00002A B9E3 2B               6      DEC HL
00002B B9E4 77               7      LD  (HL),A
00002C B9E5 210000          10      LD  HL,0
00002F B9E8 220180          16      LD  (BASIC_DEF),HL
                                
000032 B9EB F3               4      DI
000033 B9EC 3A41F3          13      LD  A,(RAMAD0)
000036 B9EF CDB0BF          17      CALL    ENASLT_00H
                                
000039 B9F2 3E                      DB  03EH    ;LD A,?
00003A B9F3 F1              10      POP AF
00003B B9F4 320DFE          13      LD  (H_CMD),A
                                
00003E B9F7 3EC3             7      LD  A,0C3H      ;JP
                                
000040 B9F9 2103C0          10      LD  HL,CPM_WBOOT
000043 B9FC 320000          13      LD  (00000H),A
000046 B9FF 220100          16      LD  (00001H),HL
                                
000049 BA02 21B8B8          10      LD  HL,BDOS0
00004C BA05 320500          13      LD  (00005H),A
00004F BA08 220600          16      LD  (00006H),HL
                                
000052 BA0B 21C4BA          10      LD  HL,BDOS1
000055 BA0E 32B8B8          13      LD  (BDOS0),A
000058 BA11 22B9B8          16      LD  (BDOS0+1),HL
                                
00005B BA14 320EFE          13      LD  (H_CMD+1),A
00005E BA17 213DBD          10      LD  HL,_CMD
000061 BA1A 220FFE          16      LD  (H_CMD+2),HL
                                
000064 BA1D 3A3CBD          13      LD  A,(MAJOR_VER)
000067 BA20 B7               4      OR  A
000068 BA21 2043            12      JR  NZ,ISC_END
                                                ;インタースロットコール
00006A BA23 3EC3             7      LD  A,0C3H      ;JP
00006C BA25 21A4C1          10      LD  HL,RDSLT
00006F BA28 320C00          13      LD  (_RDSLT),A
000072 BA2B 220D00          16      LD  (_RDSLT+1),HL
                                
000075 BA2E 21C2C1          10      LD  HL,WRSLT
000078 BA31 321400          13      LD  (_WRSLT),A
00007B BA34 221500          16      LD  (_WRSLT+1),HL
                                
00007E BA37 2155C1          10      LD  HL,CALSLT
000081 BA3A 321C00          13      LD  (_CALSLT),A
000084 BA3D 221D00          16      LD  (_CALSLT+1),HL
                                
000087 BA40 21C2C0          10      LD  HL,ENASLT
00008A BA43 322400          13      LD  (_ENASLT),A
00008D BA46 222500          16      LD  (_ENASLT+1),HL
                                
000090 BA49 2145C1          10      LD  HL,CALLF
000093 BA4C 323000          13      LD  (_CALLF),A
000096 BA4F 223100          16      LD  (_CALLF+1),HL
                                                ;割り込み
000099 BA52 21DEC1          10      LD  HL,INT38H
00009C BA55 323800          13      LD  (00038H),A
00009F BA58 223900          16      LD  (00038H+1),HL
                                
0000A2 BA5B 21CEBF          10      LD  HL,AT_3B
0000A5 BA5E 113B00          10      LD  DE,ENASUB
0000A8 BA61 011000          10      LD  BC,AT_3B_E-AT_3B
0000AB BA64 EDB0                    LDIR
       BA66                     ISC_END:
0000AD BA66 3AC1FC          13      LD  A,(EXPTBL)
0000B0 BA69 CDB0BF          17      CALL    ENASLT_00H
0000B3 BA6C FB               4      EI
                                
0000B4 BA6D 1198BA          10      LD  DE,TITLE
0000B7 BA70 0E09             7      LD  C,9
0000B9 BA72 CD7DF3          17      CALL    BDOS
0000BC BA75 3A3CBD          13      LD  A,(MAJOR_VER)
0000BF BA78 B7               4      OR  A
0000C0 BA79 2814            12      JR  Z,MSX1
0000C2 BA7B 3D               4      DEC A
0000C3 BA7C 2809            12      JR  Z,TABLACUS
0000C5 BA7E 1E32             7      LD  E,'2'
0000C7 BA80 0E02             7      LD  C,2
0000C9 BA82 CD7DF3          17      CALL    BDOS
0000CC BA85 2808            12      JR  Z,MSX1
       BA87                     TABLACUS:
0000CE BA87 11B2BA          10      LD  DE,TITLET
0000D1 BA8A 0E09             7      LD  C,9
0000D3 BA8C CD7DF3          17      CALL    BDOS
       BA8F                     MSX1:
0000D6 BA8F 11A5BA          10      LD  DE,TITLE2
0000D9 BA92 0E09             7      LD  C,9
0000DB BA94 CD7DF3          17      CALL    BDOS
0000DE BA97 C9              10      RET
                                
                                ; Version
       BA98                     TITLE:
0000DF BA98 5461626C61637573        DB  "Tablacus DOS$"
            20444F5324          
       BAA5                     TITLE2:
0000EC BAA5 20636D642076302E        DB  " cmd v0.03"
            3033                
0000F6 BAAF 0D0A24                  DB  00DH,00AH,'$'
       BAB2                     TITLET:
0000F9 BAB2 28524F4D2924            DB  "(ROM)$"
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "DOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       BAB8                     TERM:
0000FF BAB8 78               4      LD  A,B
000100 BAB9 32FFBF          13      LD  (TERMCODE),A
000103 BABC 210000          10      LD  HL,0
000106 BABF E5              11      PUSH    HL
000107 BAC0 2A2FBD          16      LD  HL,(DEFAB)
00010A BAC3 E9               4      JP  (HL)
       BAC4                     BDOS1:
00010B BAC4 0C               4      INC C
00010C BAC5 0D               4      DEC C
                                                ;BDOS0+013Hを0にするとバッチ停止されるため0が書き込みされる場合がある
00010D BAC6 CA0000          10      JP  Z,0     ;だから、ここのアドレスをBDOS0+011HもしくはBDOS0+012Hにする
000110 BAC9 ED733ABD        20      LD  (SAVE_SP),SP
000114 BACD 322ABD          13      LD  (SAVE_A),A
000117 BAD0 79               4      LD  A,C
000118 BAD1 FE62             7      CP  062H        ;_TERM エラーコードを返して終了
00011A BAD3 28E3            12      JR  Z,TERM
00011C BAD5 3A3BBD          13      LD  A,(SAVE_SP+1)
00011F BAD8 87               4      ADD A,A
000120 BAD9 3804            12      JR  C,BDOS_SPOK
000122 BADB ED7B0FC0        20      LD  SP,(BASSP)
       BADF                     BDOS_SPOK:
000126 BADF 79               4      LD  A,C
000127 BAE0 FE09             7      CP  9       ;_STROUT 文字列出力
000129 BAE2 CA93BC          10      JP  Z,_SYS09
00012C BAE5 FE63             7      CP  063H        ;_DEFAB アボート終了ルーチンの定義
00012E BAE7 2004            12      JR  NZ,BDOS2
000130 BAE9 ED532FBD        20      LD  (DEFAB),DE
       BAED                     BDOS2:
000134 BAED FE1A             7      CP  01AH        ;_SETDTA DTAの設定
000136 BAEF 2004            12      JR  NZ,BDOS2_
000138 BAF1 ED5331BD        20      LD  (_DTA),DE
       BAF5                     BDOS2_:
00013C BAF5 3233BD          13      LD  (SAVE_C),A
00013F BAF8 FE0F             7      CP  00FH        ;_FOPEN ファイルオープン
000141 BAFA 3859            12      JR  C,SAVEFCB0
000143 BAFC FE12             7      CP  012H        ;_SNEXT ファイル検索 続き
000145 BAFE 2004            12      JR  NZ,NOBD12
000147 BB00 ED5B07F3        20      LD  DE,(FCB11)
       BB04                     NOBD12:
00014B BB04 FE18             7      CP  018H        ;_LOGIN ログインベクトルの獲得
00014D BB06 383A            12      JR  C,SAVEFCB36
00014F BB08 FE21             7      CP  021H        ;_RDRND ランダム読み出し
000151 BB0A 3849            12      JR  C,SAVEFCB0
000153 BB0C FE29             7      CP  028H+1      ;_WRZER ゼロ書き込みを伴うランダム書き込み+1
000155 BB0E 3832            12      JR  C,SAVEFCB36
000157 BB10 FE31             7      CP  031H        ;_DPARM ディスクパラメータの獲得
000159 BB12 282E            12      JR  Z,SAVEFCB36
00015B BB14 FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
00015D BB16 282A            12      JR  Z,SAVE_PATH
00015F BB18 FE42             7      CP  042H        ;_FNEW 新しいエントリの検索
000161 BB1A 2826            12      JR  Z,SAVE_PATH
000163 BB1C FE43             7      CP  043H        ;_OPEN ファイルハンドルのオープン
000165 BB1E 2822            12      JR  Z,SAVE_PATH
000167 BB20 FE44             7      CP  044H        ;_CREATE ファイルハンドルの作成
000169 BB22 281E            12      JR  Z,SAVE_PATH
00016B BB24 FE4C             7      CP  04CH        ;_HTEST ファイルハンドルの検査
00016D BB26 281A            12      JR  Z,SAVE_PATH
00016F BB28 FE4D             7      CP  04DH        ;_DELETE ファイル、サブディレクトリの削除
000171 BB2A 3829            12      JR  C,SAVEFCB0
000173 BB2C FE52             7      CP  051H+1      ;_FTIME ファイルの日付および時刻の獲得・設定
000175 BB2E 3812            12      JR  C,SAVE_PATH
000177 BB30 FE59             7      CP  059H        ;_GETCD カレントディレクトリの獲得
000179 BB32 3821            12      JR  C,SAVEFCB0
00017B BB34 FE5D             7      CP  05CH+1      ;_PFILE ファイル名の解析+1
00017D BB36 380A            12      JR  C,SAVE_PATH
00017F BB38 FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
000181 BB3A 2806            12      JR  Z,SAVE_PATH
000183 BB3C FE66             7      CP  066H        ;_EXPLAIN エラーコードの説明
000185 BB3E 2802            12      JR  Z,SAVE_PATH
000187 BB40 1813            12      JR  SAVEFCB0
       BB42                     SAVEFCB36:
       BB42                     SAVE_PATH:
000189 BB42 7A               4      LD  A,D
00018A BB43 FE3F             7      CP  03FH        ;ページ1にかぶる？
00018C BB45 380E            12      JR  C,SAVEFCB0
00018E BB47 FE80             7      CP  080H
000190 BB49 300A            12      JR  NC,SAVEFCB0
000192 BB4B 3E24             7      LD  A,36
000194 BB4D CB71             8      BIT 6,C     ;DOS2のファンクションコール？
000196 BB4F 2805            12      JR  Z,SAVEFCB1
000198 BB51 3E40             7      LD  A,64        ;DOS2CALLは64バイト設定する
00019A BB53 1801            12      JR  SAVEFCB1
       BB55                     SAVEFCB0:
00019C BB55 AF               4      XOR A
       BB56                     SAVEFCB1:
00019D BB56 322BBD          13      LD  (DE_MEM_SIZE),A
0001A0 BB59 B7               4      OR  A
0001A1 BB5A 2815            12      JR  Z,BDOS3
0001A3 BB5C C5              11      PUSH    BC
0001A4 BB5D E5              11      PUSH    HL
0001A5 BB5E ED5334BD        20      LD  (SAVE_DE),DE
0001A9 BB62 4F               4      LD  C,A
0001AA BB63 0600             7      LD  B,0
0001AC BB65 21BBB8          10      LD  HL,ALT_MEM
0001AF BB68 EB               4      EX  DE,HL
0001B0 BB69 D5              11      PUSH    DE
0001B1 BB6A EDB0                    LDIR
0001B3 BB6C AF               4      XOR A
0001B4 BB6D 12               7      LD  (DE),A
0001B5 BB6E D1              10      POP DE
0001B6 BB6F E1              10      POP HL
0001B7 BB70 C1              10      POP BC
       BB71                     BDOS3:
0001B8 BB71 AF               4      XOR A
0001B9 BB72 3237BD          13      LD  (SAVE_IX+1),A
0001BC BB75 79               4      LD  A,C
0001BD BB76 FE40             7      CP  040H        ;最初のエントリ検索
0001BF BB78 3826            12      JR  C,BDOS3IX   ;次のエントリ検索
0001C1 BB7A FE43             7      CP  042H+1      ;新しいエントリの検索
0001C3 BB7C 3022            12      JR  NC,BDOS3IX
0001C5 BB7E DD7C             9      LD  A,IXH
0001C7 BB80 FE3F             7      CP  03FH        ;ページ1にかぶる？
0001C9 BB82 381C            12      JR  C,BDOS3IX
0001CB BB84 FE80             7      CP  080H        ;
0001CD BB86 3018            12      JR  NC,BDOS3IX
0001CF BB88 DD2236BD        20      LD  (SAVE_IX),IX
0001D3 BB8C C5              11      PUSH    BC
0001D4 BB8D D5              11      PUSH    DE
0001D5 BB8E E5              11      PUSH    HL
0001D6 BB8F DDE5            15      PUSH    IX
0001D8 BB91 E1              10      POP HL
0001D9 BB92 11FBB8          10      LD  DE,ALT_MEM2
0001DC BB95 014000          10      LD  BC,64
0001DF BB98 D5              11      PUSH    DE
0001E0 BB99 EDB0                    LDIR
0001E2 BB9B DDE1            14      POP IX
0001E4 BB9D E1              10      POP HL
0001E5 BB9E D1              10      POP DE
0001E6 BB9F C1              10      POP BC
       BBA0                     BDOS3IX:
0001E7 BBA0 AF               4      XOR A
0001E8 BBA1 3239BD          13      LD  (SAVE_HL+1),A
0001EB BBA4 79               4      LD  A,C
0001EC BBA5 FE4E             7      CP  4EH     ;_RENAME ファイルあるいはサブディレクトリ名の変更
0001EE BBA7 281C            12      JR  Z,SAVE_HL1
0001F0 BBA9 FE4F             7      CP  4FH     ;_MOVE ファイルあるいはサブディレクトリの移動
0001F2 BBAB 2818            12      JR  Z,SAVE_HL1
0001F4 BBAD FE53             7      CP  53H     ;_HRENAME ファイルハンドルの名前の変更
0001F6 BBAF 2814            12      JR  Z,SAVE_HL1
0001F8 BBB1 FE54             7      CP  54H     ;_HMOVE ファイルハンドルの移動
0001FA BBB3 2810            12      JR  Z,SAVE_HL1
0001FC BBB5 FE5C             7      CP  05CH        ;_PFILE ファイル名の解析
0001FE BBB7 280C            12      JR  Z,SAVE_HL1
000200 BBB9 FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
000202 BBBB 2804            12      JR  Z,FIBCHECK
000204 BBBD FE42             7      CP  042H        ;_FNEW 新しいエントリ検索
000206 BBBF 201F            12      JR  NZ,BDOS3HL
       BBC1                     FIBCHECK:
000208 BBC1 1A               7      LD  A,(DE)
000209 BBC2 3C               4      INC A       ;DEがFIBならば0FFH
00020A BBC3 201B            12      JR  NZ,BDOS3HL
       BBC5                     SAVE_HL1:
00020C BBC5 7C               4      LD  A,H
00020D BBC6 FE3F             7      CP  03FH        ;ページ1にかぶる？
00020F BBC8 3816            12      JR  C,BDOS3HL
000211 BBCA FE80             7      CP  080H        ;
000213 BBCC 3012            12      JR  NC,BDOS3HL
000215 BBCE 2238BD          16      LD  (SAVE_HL),HL
000218 BBD1 C5              11      PUSH    BC
000219 BBD2 D5              11      PUSH    DE
00021A BBD3 014000          10      LD  BC,64
00021D BBD6 113BB9          10      LD  DE,ALT_MEM3
000220 BBD9 EDB0                    LDIR
000222 BBDB D1              10      POP DE
000223 BBDC C1              10      POP BC
000224 BBDD 213BB9          10      LD  HL,ALT_MEM3
       BBE0                     BDOS3HL:
000227 BBE0 79               4      LD  A,C
000228 BBE1 FE2F             7      CP  02FH
00022A BBE3 CAA3BC          10      JP  Z,RDABS
00022D BBE6 FE30             7      CP  030H
00022F BBE8 CAEFBC          10      JP  Z,WRABS
       BBEB                     BDOS_EXEC:
000232 BBEB 3A2ABD          13      LD  A,(SAVE_A)
000235 BBEE CD7DF3          17      CALL    BDOS
                                
000238 BBF1 F5              11      PUSH    AF
                                
000239 BBF2 3A37BD          13      LD  A,(SAVE_IX+1)       ;最初のエントリ検索 + 次のエントリ検索
00023C BBF5 B7               4      OR  A
00023D BBF6 2815            12      JR  Z,BDOS4IX
00023F BBF8 DD2A36BD        20      LD  IX,(SAVE_IX)
000243 BBFC C5              11      PUSH    BC
000244 BBFD D5              11      PUSH    DE
000245 BBFE E5              11      PUSH    HL
000246 BBFF DDE5            15      PUSH    IX
000248 BC01 D1              10      POP DE
000249 BC02 21FBB8          10      LD  HL,ALT_MEM2
00024C BC05 014000          10      LD  BC,64
00024F BC08 EDB0                    LDIR
000251 BC0A E1              10      POP HL
000252 BC0B D1              10      POP DE
000253 BC0C C1              10      POP BC
       BC0D                     BDOS4IX:
000254 BC0D 3A2BBD          13      LD  A,(DE_MEM_SIZE)
000257 BC10 B7               4      OR  A
000258 BC11 2812            12      JR  Z,BDOS4
00025A BC13 C5              11      PUSH    BC
00025B BC14 D5              11      PUSH    DE
00025C BC15 E5              11      PUSH    HL
00025D BC16 4F               4      LD  C,A
00025E BC17 0600             7      LD  B,0
000260 BC19 21BBB8          10      LD  HL,ALT_MEM
000263 BC1C ED5B34BD        20      LD  DE,(SAVE_DE)
000267 BC20 EDB0                    LDIR
000269 BC22 E1              10      POP HL
00026A BC23 D1              10      POP DE
00026B BC24 C1              10      POP BC
       BC25                     BDOS4:
00026C BC25 3A39BD          13      LD  A,(SAVE_HL+1)
00026F BC28 B7               4      OR  A
000270 BC29 2812            12      JR  Z,BDOS5
000272 BC2B C5              11      PUSH    BC
000273 BC2C D5              11      PUSH    DE
000274 BC2D E5              11      PUSH    HL
000275 BC2E 010B00          10      LD  BC,11
000278 BC31 213BB9          10      LD  HL,ALT_MEM3
00027B BC34 ED5B38BD        20      LD  DE,(SAVE_HL)
00027F BC38 EDB0                    LDIR
000281 BC3A E1              10      POP HL
000282 BC3B D1              10      POP DE
000283 BC3C C1              10      POP BC
       BC3D                     BDOS5:
000284 BC3D 3A33BD          13      LD  A,(SAVE_C)
000287 BC40 FE6F             7      CP  06FH        ;_DOSVER MSX-DOSのバージョン番号の獲得
000289 BC42 2013            12      JR  NZ,BDOS7
00028B BC44 04               4      INC B
00028C BC45 05               4      DEC B
00028D BC46 2802            12      JR  Z,S6F_1
00028F BC48 59               4      LD  E,C     ;DOS2の場合
000290 BC49 50               4      LD  D,B     ;MSXDOS2.SYSのバージョンをカーネルに合わす
       BC4A                     S6F_1:
000291 BC4A DD25            10      DEC IXH     ;NEXTOR判別
000293 BC4C 2807            12      JR  Z,NEXTOR
000295 BC4E DD21EDEC        14      LD  IX,0ECEDH   ;似非DOS判別用(INC IXがあるのでIXが0EDEDHになる)
000299 BC52 210100          10      LD  HL,VER_BCD  ;NEXTORじゃない場合はHLに似非DOSのバージョンが返る
       BC55                     NEXTOR:
00029C BC55 DD24            10      INC IXH
       BC57                     BDOS7:
00029E BC57 FE5B             7      CP  05BH        ;_PARSE パス名の解析
0002A0 BC59 2804            12      JR  Z,BDOS8
0002A2 BC5B FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
0002A4 BC5D 201E            12      JR  NZ,BDOS6
       BC5F                     BDOS8:
0002A6 BC5F 3A2BBD          13      LD  A,(DE_MEM_SIZE)
0002A9 BC62 2819            12      JR  Z,BDOS6
0002AB BC64 C5              11      PUSH    BC
0002AC BC65 01BBB8          10      LD  BC,ALT_MEM
0002AF BC68 ED42            15      SBC HL,BC       ;CF=0のハズ
0002B1 BC6A ED4B34BD        20      LD  BC,(SAVE_DE)
0002B5 BC6E 09              11      ADD HL,BC
0002B6 BC6F EB               4      EX  DE,HL
0002B7 BC70 01BBB8          10      LD  BC,ALT_MEM
0002BA BC73 A7               4      AND A       ;念のためにCF=0にする
0002BB BC74 ED42            15      SBC HL,BC
0002BD BC76 ED4B34BD        20      LD  BC,(SAVE_DE)
0002C1 BC7A 09              11      ADD HL,BC
0002C2 BC7B EB               4      EX  DE,HL
0002C3 BC7C C1              10      POP BC
       BC7D                     BDOS6:
0002C4 BC7D F1              10      POP AF
       BC7E                     S09X1:
0002C5 BC7E ED7B3ABD        20      LD  SP,(SAVE_SP)
0002C9 BC82 C9              10      RET
                                
       BC83                     CONST1:
0002CA BC83 0E0B             7      LD  C,0BH
0002CC BC85 C30500          10      JP  SYSTEM
       BC88                     CONIN1:
0002CF BC88 0E07             7      LD  C,7
0002D1 BC8A C30500          10      JP  SYSTEM
       BC8D                     CONOUT1:
0002D4 BC8D 59               4      LD  E,C
0002D5 BC8E 0E02             7      LD  C,2
0002D7 BC90 C30500          10      JP  SYSTEM
                                
       BC93                     _SYS09:     ;_STROUT 文字列出力
0002DA BC93 1A               7      LD  A,(DE)
0002DB BC94 13               6      INC DE
0002DC BC95 FE24             7      CP  '$'
0002DE BC97 28E5            12      JR  Z,S09X1
0002E0 BC99 D5              11      PUSH    DE
0002E1 BC9A 0E02             7      LD  C,2
0002E3 BC9C 5F               4      LD  E,A
0002E4 BC9D CD7DF3          17      CALL    BDOS
0002E7 BCA0 D1              10      POP DE
0002E8 BCA1 18F0            12      JR  _SYS09
                                
       BCA3                     RDABS:
0002EA BCA3 3A32BD          13      LD  A,(_DTA+1)
0002ED BCA6 87               4      ADD A,A
0002EE BCA7 DAEBBB          10      JP  C,BDOS_EXEC
                                
0002F1 BCAA D5              11      PUSH    DE
0002F2 BCAB E5              11      PUSH    HL
0002F3 BCAC 11BBB8          10      LD  DE,BUF512
0002F6 BCAF 0E1A             7      LD  C,01AH      ;_SETDTA
0002F8 BCB1 CD7DF3          17      CALL    BDOS
0002FB BCB4 E1              10      POP HL
0002FC BCB5 D1              10      POP DE
                                
0002FD BCB6 ED4B31BD        20      LD  BC,(_DTA)
       BCBA                     RDABS1:
000301 BCBA D5              11      PUSH    DE
000302 BCBB E5              11      PUSH    HL
000303 BCBC C5              11      PUSH    BC
000304 BCBD 2601             7      LD  H,1
000306 BCBF 0E2F             7      LD  C,02FH      ;_RDABS
000308 BCC1 CD7DF3          17      CALL    BDOS
00030B BCC4 E1              10      POP HL      ;<=転送先
00030C BCC5 FEFF             7      CP  0FFH
00030E BCC7 2814            12      JR  Z,RDABS_ERR
000310 BCC9 EB               4      EX  DE,HL
000311 BCCA 21BBB8          10      LD  HL,BUF512
000314 BCCD 010002          10      LD  BC,512
000317 BCD0 EDB0                    LDIR
000319 BCD2 4B               4      LD  C,E
00031A BCD3 42               4      LD  B,D
00031B BCD4 E1              10      POP HL
00031C BCD5 D1              10      POP DE
00031D BCD6 13               6      INC DE
00031E BCD7 25               4      DEC H
00031F BCD8 20E0            12      JR  NZ,RDABS1
       BCDA                     WRABS_OK:
000321 BCDA AF               4      XOR A
       BCDB                     WRABS_ERR:
000322 BCDB D5              11      PUSH    DE
000323 BCDC E5              11      PUSH    HL
       BCDD                     RDABS_ERR:
000324 BCDD F5              11      PUSH    AF
000325 BCDE ED5B31BD        20      LD  DE,(_DTA)
000329 BCE2 0E1A             7      LD  C,01AH      ;_SETDTA
00032B BCE4 CD7DF3          17      CALL    BDOS
00032E BCE7 F1              10      POP AF
00032F BCE8 E1              10      POP HL
000330 BCE9 D1              10      POP DE
000331 BCEA ED7B3ABD        20      LD  SP,(SAVE_SP)
000335 BCEE C9              10      RET
                                
       BCEF                     WRABS:
000336 BCEF 3A32BD          13      LD  A,(_DTA+1)
000339 BCF2 87               4      ADD A,A
00033A BCF3 DAEBBB          10      JP  C,BDOS_EXEC
00033D BCF6 D5              11      PUSH    DE
00033E BCF7 E5              11      PUSH    HL
00033F BCF8 11BBB8          10      LD  DE,BUF512
000342 BCFB 0E1A             7      LD  C,01AH      ;_SETDTA
000344 BCFD CD7DF3          17      CALL    BDOS
000347 BD00 E1              10      POP HL
000348 BD01 D1              10      POP DE
                                
000349 BD02 ED4B31BD        20      LD  BC,(_DTA)
       BD06                     WRABS1:
00034D BD06 D5              11      PUSH    DE
00034E BD07 E5              11      PUSH    HL
00034F BD08 69               4      LD  L,C
000350 BD09 60               4      LD  H,B
000351 BD0A 11BBB8          10      LD  DE,BUF512
000354 BD0D 010002          10      LD  BC,512
000357 BD10 EDB0                    LDIR
000359 BD12 E3              19      EX  (SP),HL
00035A BD13 D1              10      POP DE
                                
00035B BD14 D5              11      PUSH    DE
00035C BD15 E5              11      PUSH    HL
00035D BD16 2601             7      LD  H,1
00035F BD18 0E30             7      LD  C,030H      ;_WRABS
000361 BD1A CD7DF3          17      CALL    BDOS
000364 BD1D E1              10      POP HL
000365 BD1E D1              10      POP DE
000366 BD1F C1              10      POP BC
000367 BD20 FEFF             7      CP  0FFH
000369 BD22 28B7            12      JR  Z,WRABS_ERR
00036B BD24 13               6      INC DE
00036C BD25 25               4      DEC H
00036D BD26 20DE            12      JR  NZ,WRABS1
00036F BD28 18B0            12      JR  WRABS_OK
                                
       BD2A                     SAVE_A:
000371 BD2A 00                      DB  0
       BD2B                     DE_MEM_SIZE:
000372 BD2B 0000                    DW  0
       BD2D                     EXTSP:
000374 BD2D 0000                    DW  0
       BD2F                     DEFAB:
000376 BD2F 0000                    DW  0
       BD31                     _DTA:
000378 BD31 0000                    DW  0
       BD33                     SAVE_C:
00037A BD33 00                      DB  0
       BD34                     SAVE_DE:
00037B BD34 0000                    DW  0
       BD36                     SAVE_IX:
00037D BD36 0000                    DW  0
       BD38                     SAVE_HL:
00037F BD38 0000                    DW  0
       BD3A                     SAVE_SP:
000381 BD3A 0000                    DW  0
       BD3C                     MAJOR_VER:
000383 BD3C 00                      DB  0
[EOF:DOS.ASM:UTF_8]
                                    INCLUDE "CMD.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       BD3D                     _CMD:
000384 BD3D F3               4      DI
000385 BD3E CD644C          17      CALL    FRMEVL
000388 BD41 E5              11      PUSH    HL
000389 BD42 ED730FC0        20      LD  (BASSP),SP
00038D BD46 21C0FF          10      LD  HL,-64
000390 BD49 39              11      ADD HL,SP
000391 BD4A F9               6      LD  SP,HL
                                
000392 BD4B CDD067          17      CALL    FRESTR
000395 BD4E 0600             7      LD  B,0
000397 BD50 4E               7      LD  C,(HL)
000398 BD51 23               6      INC HL
000399 BD52 7E               7      LD  A,(HL)
00039A BD53 23               6      INC HL
00039B BD54 66               7      LD  H,(HL)
00039C BD55 6F               4      LD  L,A
00039D BD56 11E0B8          10      LD  DE,BUFSTR
0003A0 BD59 79               4      LD  A,C
0003A1 BD5A B7               4      OR  A
0003A2 BD5B CA4BBE          10      JP  Z,WBOOT1
0003A5 BD5E EDB0                    LDIR
0003A7 BD60 AF               4      XOR A
0003A8 BD61 12               7      LD  (DE),A
                                
0003A9 BD62 3A41F3          13      LD  A,(RAMAD0)
0003AC BD65 CDB0BF          17      CALL    ENASLT_00H  ;ページ0をRAMに切り替える
0003AF BD68 3A42F3          13      LD  A,(RAMAD1)
0003B2 BD6B 2640             7      LD  H,040H
0003B4 BD6D CD2400          17      CALL    _ENASLT     ;ページ1をRAMに切り替える
                                
0003B7 BD70 21BBB8          10      LD  HL,FDRV
0003BA BD73 0625             7      LD  B,37
0003BC BD75 AF               4      XOR A
       BD76                     ZERO_FCB:
0003BD BD76 77               7      LD  (HL),A
0003BE BD77 23               6      INC HL
0003BF BD78 10FC            13      DJNZ    ZERO_FCB
                                
0003C1 BD7A 11E0B8          10      LD  DE,BUFSTR
0003C4 BD7D CD7DBE          17      CALL    FILE
0003C7 BD80 D5              11      PUSH    DE
                                
0003C8 BD81 3A3CBD          13      LD  A,(MAJOR_VER)
0003CB BD84 FE02             7      CP  2
0003CD BD86 3035            12      JR  NC,DOS2_READ
0003CF BD88 11BBB8          10      LD  DE,FDRV
0003D2 BD8B 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン(_FOPEN)
0003D4 BD8D CD7DF3          17      CALL    BDOS
0003D7 BD90 3C               4      INC A
0003D8 BD91 D1              10      POP DE
0003D9 BD92 CA4BBE          10      JP  Z,WBOOT1
0003DC BD95 D5              11      PUSH    DE
                                
0003DD BD96 210100          10      LD  HL,1
0003E0 BD99 22C9B8          16      LD  (FDRV+14),HL
0003E3 BD9C 6C               4      LD  L,H
0003E4 BD9D 22DCB8          16      LD  (FDRV+33),HL
0003E7 BDA0 22DEB8          16      LD  (FDRV+35),HL
                                
0003EA BDA3 110001          10      LD  DE,00100H
0003ED BDA6 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
0003EF BDA8 CD7DF3          17      CALL    BDOS
                                
0003F2 BDAB 21B8B7          10      LD  HL,BDOS0-00100H
0003F5 BDAE 11BBB8          10      LD  DE,FDRV
0003F8 BDB1 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0003FA BDB3 CD7DF3          17      CALL    BDOS
0003FD BDB6 3D               4      DEC A
0003FE BDB7 D1              10      POP DE
0003FF BDB8 C24BBE          10      JP  NZ,WBOOT1
000402 BDBB 1832            12      JR  SET_PARAM
       BDBD                     DOS2_READ:
000404 BDBD 1A               7      LD  A,(DE)
000405 BDBE F5              11      PUSH    AF
000406 BDBF AF               4      XOR A
000407 BDC0 12               7      LD  (DE),A
000408 BDC1 21DEBF          10      LD  HL,N_PROGRAM
00040B BDC4 11E0B8          10      LD  DE,BUFSTR
00040E BDC7 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000410 BDC9 CD7DF3          17      CALL    BDOS
000413 BDCC 11E0B8          10      LD  DE,BUFSTR
000416 BDCF 0E43             7      LD  C,043H      ;(BDOS)ファイルハンドルのオープン
000418 BDD1 CD7DF3          17      CALL    BDOS
00041B BDD4 E1              10      POP HL
00041C BDD5 B7               4      OR  A
00041D BDD6 D1              10      POP DE
00041E BDD7 2072            12      JR  NZ,WBOOT1
000420 BDD9 7C               4      LD  A,H
000421 BDDA 12               7      LD  (DE),A
000422 BDDB D5              11      PUSH    DE
000423 BDDC C5              11      PUSH    BC
000424 BDDD 110001          10      LD  DE,00100H
000427 BDE0 21B8B7          10      LD  HL,BDOS0-00100H
00042A BDE3 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し
00042C BDE5 CD7DF3          17      CALL    BDOS
00042F BDE8 C1              10      POP BC
000430 BDE9 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ
000432 BDEB CD7DF3          17      CALL    BDOS
000435 BDEE D1              10      POP DE
       BDEF                     SET_PARAM:
000436 BDEF 215C00          10      LD  HL,FCB1
       BDF2                     ZERO1:
000439 BDF2 74               7      LD  (HL),H
00043A BDF3 2C               4      INC L
00043B BDF4 20FC            12      JR  NZ,ZERO1
                                
00043D BDF6 0600             7      LD  B,0
00043F BDF8 218100          10      LD  HL,DTA1+1
       BDFB                     PARAM1:
000442 BDFB 1A               7      LD  A,(DE)
000443 BDFC 77               7      LD  (HL),A
000444 BDFD B7               4      OR  A
000445 BDFE 2805            12      JR  Z,PARAM2
000447 BE00 13               6      INC DE
000448 BE01 23               6      INC HL
000449 BE02 04               4      INC B
00044A BE03 18F6            12      JR  PARAM1
       BE05                     PARAM2:
00044C BE05 78               4      LD  A,B
00044D BE06 328000          13      LD  (DTA1),A
                                
000450 BE09 118100          10      LD  DE,DTA1+1
000453 BE0C CD7DBE          17      CALL    FILE
000456 BE0F D5              11      PUSH    DE
000457 BE10 21BBB8          10      LD  HL,FDRV
00045A BE13 115C00          10      LD  DE,FCB1
00045D BE16 011000          10      LD  BC,00010H
000460 BE19 EDB0                    LDIR
000462 BE1B D1              10      POP DE
000463 BE1C 216C00          10      LD  HL,FCB2
000466 BE1F CD7DBE          17      CALL    FILE
000469 BE22 21BBB8          10      LD  HL,FDRV
00046C BE25 116C00          10      LD  DE,FCB2
00046F BE28 011000          10      LD  BC,00010H
000472 BE2B EDB0                    LDIR
000474 BE2D 3A3CBD          13      LD  A,(MAJOR_VER)
000477 BE30 FE02             7      CP  2
000479 BE32 380B            12      JR  C,DOS1_PARAM
00047B BE34 21E6BF          10      LD  HL,N_PARAMETERS
00047E BE37 118100          10      LD  DE,DTA1+1
000481 BE3A 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000483 BE3C CD7DF3          17      CALL    BDOS
       BE3F                     DOS1_PARAM:
000486 BE3F AF               4      XOR A
000487 BE40 6F               4      LD  L,A
000488 BE41 67               4      LD  H,A
000489 BE42 32FFBF          13      LD  (TERMCODE),A
00048C BE45 222FBD          16      LD  (DEFAB),HL
00048F BE48 CD0001          17      CALL    00100H
       BE4B                     WBOOT1:
000492 BE4B ED7B0FC0        20      LD  SP,(BASSP)
000496 BE4F 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
000499 BE52 CDB0BF          17      CALL    ENASLT_00H  ;ページ0をROMに切り替える
00049C BE55 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
00049F BE58 2640             7      LD  H,040H
0004A1 BE5A CD2400          17      CALL    _ENASLT     ;ページ1をROMに切り替える
0004A4 BE5D E1              10      POP HL
0004A5 BE5E FB               4      EI
0004A6 BE5F C9              10      RET
                                
       BE60                     FILED2:             ;DOS2
0004A7 BE60 CD45BF          17      CALL    SPCUT
0004AA BE63 D5              11      PUSH    DE
0004AB BE64 0E5B             7      LD  C,05BH      ;(BDOS) パス名の解析
0004AD BE66 CD7DF3          17      CALL    BDOS
0004B0 BE69 D1              10      POP DE
0004B1 BE6A 13               6      INC DE
0004B2 BE6B 1A               7      LD  A,(DE)
0004B3 BE6C FE3A             7      CP  ':'
0004B5 BE6E 2004            12      JR  NZ,FILED2_1
0004B7 BE70 79               4      LD  A,C
0004B8 BE71 32BBB8          13      LD  (FDRV),A
       BE74                     FILED2_1:
0004BB BE74 EB               4      EX  DE,HL
0004BC BE75 21BCB8          10      LD  HL,FNAME
0004BF BE78 0E5C             7      LD  C,05CH      ;(BDOS) ファイル名の解析
0004C1 BE7A C37DF3          10      JP  BDOS
       BE7D                     FILE:
0004C4 BE7D 3A3CBD          13      LD  A,(MAJOR_VER)   ;Tablacus Disk ROM Lite
0004C7 BE80 FE01             7      CP  1
0004C9 BE82 283E            12      JR  Z,FILE_TDRL
0004CB BE84 FE02             7      CP  2
0004CD BE86 30D8            12      JR  NC,FILED2
0004CF BE88 AF               4      XOR A
0004D0 BE89 32BBB8          13      LD  (FDRV),A
0004D3 BE8C 67               4      LD  H,A
0004D4 BE8D 6F               4      LD  L,A
0004D5 BE8E 22C9B8          16      LD  (FDRV+14),HL
0004D8 BE91 CD45BF          17      CALL    SPCUT
0004DB BE94 CD2ABF          17      CALL    CCHK3
0004DE BE97 2812            12      JR  Z,DEVI1
0004E0 BE99 13               6      INC DE
0004E1 BE9A 1A               7      LD  A,(DE)
0004E2 BE9B 1B               6      DEC DE
0004E3 BE9C FE3A             7      CP  ':'
0004E5 BE9E 200B            12      JR  NZ,DEVI1
0004E7 BEA0 1A               7      LD  A,(DE)      ;DRIVE
0004E8 BEA1 CD58BF          17      CALL    CAP
0004EB BEA4 D640             7      SUB '@'
0004ED BEA6 13               6      INC DE
0004EE BEA7 13               6      INC DE
0004EF BEA8 32BBB8          13      LD  (FDRV),A
       BEAB                     DEVI1:
0004F2 BEAB 1A               7      LD  A,(DE)
0004F3 BEAC D65C             7      SUB 05CH        ;\
0004F5 BEAE 2009            12      JR  NZ,NOROOT
0004F7 BEB0 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0004F8 BEB1 22D5B8          16      LD  (FDRV+26),HL
0004FB BEB4 2C               4      INC L
0004FC BEB5 22C9B8          16      LD  (FDRV+14),HL
0004FF BEB8 13               6      INC DE
       BEB9                     NOROOT:
                                
       BEB9                     SETDIR:
000500 BEB9 CDCABE          17      CALL    FILED
000503 BEBC 1A               7      LD  A,(DE)
000504 BEBD FE5C             7      CP  05CH        ;\
000506 BEBF C0              11      RET NZ
000507 BEC0 13               6      INC DE
       BEC1                     SETDIR1:
000508 BEC1 C9              10      RET
                                
       BEC2                     FILE_TDRL:
000509 BEC2 21BBB8          10      LD  HL,FDRV
00050C BEC5 0E29             7      LD  C,029H      ;(BDOS) パス名の解析
00050E BEC7 C37DF3          10      JP  BDOS
                                
       BECA                     FILED:
000511 BECA CD11BF          17      CALL    FILEI
                                
000514 BECD 0608             7      LD  B,8
       BECF                     FILE2:
000516 BECF CD1FBF          17      CALL    CCHKF
000519 BED2 C8              11      RET Z
00051A BED3 FE2A             7      CP  '*'
00051C BED5 282E            12      JR  Z,FILE9
00051E BED7 FE2E             7      CP  '.'
000520 BED9 280C            12      JR  Z,FILE4
000522 BEDB 77               7      LD  (HL),A
000523 BEDC 23               6      INC HL
000524 BEDD 10F0            13      DJNZ    FILE2
                                
       BEDF                     FILE3:
000526 BEDF CD1FBF          17      CALL    CCHKF
000529 BEE2 C8              11      RET Z
00052A BEE3 FE2E             7      CP  '.'
00052C BEE5 20F8            12      JR  NZ,FILE3
                                
       BEE7                     FILE4:
00052E BEE7 21C4B8          10      LD  HL,FNAME+8
000531 BEEA 0603             7      LD  B,3
                                
       BEEC                     FILE4L:
000533 BEEC CD1FBF          17      CALL    CCHKF
000536 BEEF C8              11      RET Z
000537 BEF0 FE2E             7      CP  '.'
000539 BEF2 2008            12      JR  NZ,FILE12
00053B BEF4 32BCB8          13      LD  (FNAME),A   ;Parent directory(..)
00053E BEF7 32BDB8          13      LD  (FNAME+1),A
000541 BEFA 3E20             7      LD  A,020H
       BEFC                     FILE12:
000543 BEFC FE2A             7      CP  '*'
000545 BEFE 280A            12      JR  Z,FILE10
000547 BF00 77               7      LD  (HL),A
000548 BF01 23               6      INC HL
000549 BF02 10E8            13      DJNZ    FILE4L
00054B BF04 C9              10      RET
                                
       BF05                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00054C BF05 CD0ABF          17      CALL    FILE10
00054F BF08 18D5            12      JR  FILE3
                                
       BF0A                     FILE10:
000551 BF0A 3E3F             7      LD  A,'?'
                                
       BF0C                     FILL_MEMORY:                ;HLからBバイトAで埋める
000553 BF0C 77               7      LD  (HL),A
000554 BF0D 23               6      INC HL
000555 BF0E 10FC            13      DJNZ    FILL_MEMORY
000557 BF10 C9              10      RET
                                
       BF11                     FILEI:              ;名前＋拡張子をスペースで初期化
000558 BF11 3E20             7      LD  A,020H
00055A BF13 01000B          10      LD  BC,11*256
00055D BF16 21BCB8          10      LD  HL,FNAME
000560 BF19 E5              11      PUSH    HL
000561 BF1A CD0CBF          17      CALL    FILL_MEMORY
000564 BF1D E1              10      POP HL
000565 BF1E C9              10      RET
                                
       BF1F                     CCHKF:
000566 BF1F 1A               7      LD  A,(DE)
000567 BF20 CD27BF          17      CALL    CCHK2
00056A BF23 C8              11      RET Z
00056B BF24 C37ABF          10      JP  FKAN
                                
       BF27                     CCHK2:
00056E BF27 0C               4      INC C
00056F BF28 0D               4      DEC C
000570 BF29 C0              11      RET NZ
       BF2A                     CCHK3:              ;ZF=1 で使えない文字
000571 BF2A FE2B             7      CP  '+'
000573 BF2C C8              11      RET Z
000574 BF2D FE2C             7      CP  ','
000576 BF2F C8              11      RET Z
000577 BF30 FE2F             7      CP  '/'
000579 BF32 C8              11      RET Z
00057A BF33 FE3A             7      CP  ':'
00057C BF35 C8              11      RET Z
00057D BF36 FE3B             7      CP  ';'
00057F BF38 C8              11      RET Z
000580 BF39 FE3D             7      CP  '='
000582 BF3B C8              11      RET Z
000583 BF3C FE5C             7      CP  05CH    ;\
000585 BF3E C8              11      RET Z
000586 BF3F FE20             7      CP  020H
000588 BF41 D0              11      RET NC
000589 BF42 BF               4      CP  A       ;Z=1
00058A BF43 C9              10      RET
                                
       BF44                     SS1:
00058B BF44 13               6      INC DE
       BF45                     SPCUT:              ;スペースをカット
00058C BF45 1A               7      LD  A,(DE)
00058D BF46 FE20             7      CP  020H
00058F BF48 28FA            12      JR  Z,SS1
000591 BF4A C9              10      RET
                                
       BF4B                     TOZERO:
000592 BF4B D5              11      PUSH    DE
       BF4C                     TZ1:
000593 BF4C 1A               7      LD  A,(DE)
000594 BF4D FE20             7      CP  20H
000596 BF4F 3803            12      JR  C,TZ2
000598 BF51 13               6      INC DE
000599 BF52 18F8            12      JR  TZ1
       BF54                     TZ2:
00059B BF54 AF               4      XOR A
00059C BF55 12               7      LD  (DE),A
00059D BF56 D1              10      POP DE
00059E BF57 C9              10      RET
                                
       BF58                     CAP:
00059F BF58 FE61             7      CP  'a'
0005A1 BF5A D8              11      RET C
0005A2 BF5B FE7B             7      CP  'z'+1
0005A4 BF5D D0              11      RET NC
0005A5 BF5E D620             7      SUB 020H
0005A7 BF60 C9              10      RET
       BF61                     CAP2:
0005A8 BF61 CD58BF          17      CALL    CAP
       BF64                     CAP3:
0005AB BF64 CD6DBF          17      CALL    CAP4
0005AE BF67 FE21             7      CP  021H
0005B0 BF69 D0              11      RET NC
0005B1 BF6A 3E20             7      LD  A,020H
0005B3 BF6C C9              10      RET
       BF6D                     CAP4:
0005B4 BF6D FE05             7      CP  5
0005B6 BF6F C0              11      RET NZ
0005B7 BF70 3EE5             7      LD  A,0E5H
0005B9 BF72 C9              10      RET
                                
       BF73                     FKANC:
0005BA BF73 CB41             8      BIT 0,C
0005BC BF75 CC61BF          17      CALL    Z,CAP2
0005BF BF78 1801            12      JR  FKANX
       BF7A                     FKAN:           ;漢字チェック
0005C1 BF7A 13               6      INC DE
       BF7B                     FKANX:
0005C2 BF7B CB41             8      BIT 0,C
0005C4 BF7D CB81             8      RES 0,C
0005C6 BF7F C0              11      RET NZ
0005C7 BF80 FE80             7      CP  080H
0005C9 BF82 D8              11      RET C
0005CA BF83 FEA0             7      CP  0A0H
0005CC BF85 3803            12      JR  C,FKAN1
0005CE BF87 FEE0             7      CP  0E0H
0005D0 BF89 D8              11      RET C
       BF8A                     FKAN1:
0005D1 BF8A 0C               4      INC C
0005D2 BF8B A7               4      AND A
0005D3 BF8C C9              10      RET
                                
       BF8D                     CHKWILDX:
0005D4 BF8D FDE5            15      PUSH    IY
0005D6 BF8F E1              10      POP HL
0005D7 BF90 23               6      INC HL
       BF91                     CHKWILD:
0005D8 BF91 060B             7      LD  B,11
0005DA BF93 3E3F             7      LD  A,'?'
       BF95                     CHKWIL1:
0005DC BF95 BE               7      CP  (HL)
0005DD BF96 23               6      INC HL
0005DE BF97 37               4      SCF
0005DF BF98 C8              11      RET Z
0005E0 BF99 10FA            13      DJNZ    CHKWIL1
0005E2 BF9B AF               4      XOR A
0005E3 BF9C C9              10      RET
                                
       BF9D                     CALSLT_BIOS:
0005E4 BF9D FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005E8 BFA1 C31C00          10      JP  _CALSLT
                                
       BFA4                     INT38H_ROM:
0005EB BFA4 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMに切り替える
0005EE BFA7 CDB0BF          17      CALL    ENASLT_00H
0005F1 BFAA CD3800          17      CALL    00038H
0005F4 BFAD 3A41F3          13      LD  A,(RAMAD0)  ;メインRAMに切り替える
                                ;   JP  ENASLT_00H
                                ;
                                ;ページ0専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
                                ; ページ2 に配置
       BFB0                     ENASLT_00H:
0005F7 BFB0 F3               4      DI
0005F8 BFB1 67               4      LD  H,A
0005F9 BFB2 E603             7      AND 3
0005FB BFB4 4F               4      LD  C,A
0005FC BFB5 DBA8            11      IN  A,(0A8H)
0005FE BFB7 06FC             7      LD  B,0FCH  ;ページ0
000600 BFB9 A0               4      AND B
000601 BFBA B1               4      OR  C
000602 BFBB CB7C             8      BIT 7,H
000604 BFBD CA89F3          10      JP  Z,ENASLT_NOEXT
                                                ;拡張スロットの処理
000607 BFC0 D5              11      PUSH    DE
000608 BFC1 CD11C0          17      CALL    ENATBL
00060B BFC4 0F               4      RRCA
00060C BFC5 0F               4      RRCA
00060D BFC6 4F               4      LD  C,A
00060E BFC7 7B               4      LD  A,E
00060F BFC8 CDCEBF          17      CALL    AT_3B
000612 BFCB 73               7      LD  (HL),E
000613 BFCC D1              10      POP DE
000614 BFCD C9              10      RET
                                ;
                                ;   ENASLOTの補助（ページ0・003BH～にも配置）
                                ;
       BFCE                     AT_3B:              ;ENASUB 対象の拡張スロットを切り替えるために基本スロットを切り替える
000615 BFCE D3A8            11      OUT (0A8H),A
000617 BFD0 3AFFFF          13      LD  A,(0FFFFH)  ;拡張スロットの切り替え
00061A BFD3 2F               4      CPL
00061B BFD4 A0               4      AND B
00061C BFD5 B1               4      OR  C
00061D BFD6 32FFFF          13      LD  (0FFFFH),A
000620 BFD9 5F               4      LD  E,A
                                                ;基本スロットの切り替え
000621 BFDA 7A               4      LD  A,D
000622 BFDB D3A8            11      OUT (0A8H),A
000624 BFDD C9              10      RET
       BFDE                     AT_3B_E:
                                
       BFDE                     N_PROGRAM:
000625 BFDE 50524F4752414D00        DB  "PROGRAM",0
       BFE6                     N_PARAMETERS:
00062D BFE6 504152414D455445        DB  "PARAMETERS",0
            525300              
000638 BFF1                         DS  0BFFFH-$
       BFFF                     TERMCODE:
000646 BFFF 00                      DB  0
[EOF:CMD.ASM:UTF_8]
                                    INCLUDE "BIOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       C000                         ALIGN   256 ;0C000Hに配置
                                ;           下位1バイト0になるように
       C000                     CPM_BOOT:
000647 C000 C34BBE          10      JP  WBOOT1
       C003                     CPM_WBOOT:
00064A C003 C34BBE          10      JP  WBOOT1
       C006                     CPM_CONST:          ;(BDOS)コンソール直接入力
00064D C006 C383BC          10      JP  CONST1
       C009                     CPM_CONIN:
000650 C009 C388BC          10      JP  CONIN1
       C00C                     CPM_CONOUT:
000653 C00C C38DBC          10      JP  CONOUT1
       C00F                     BASSP:
000656 C00F 0000                    DW  0
                                
       C011                     ENATBL:
000658 C011 57               4      LD  D,A ;基本スロットに出力する値
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
000659 C012 7C               4      LD  A,H
00065A C013 E603             7      AND 3
00065C C015 4F               4      LD  C,A ;C=スロット#
                                
                                    ;スロットテーブル
00065D C016 2EC5             7      LD  L,LOW SLTTBL
00065F C018 85               4      ADD A,L
000660 C019 6F               4      LD  L,A
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
000661 C01A 79               4      LD  A,C ;C=スロット#
000662 C01B 0F               4      RRCA
000663 C01C 0F               4      RRCA        ;ページ3
000664 C01D 4F               4      LD  C,A
000665 C01E 7A               4      LD  A,D ;基本スロットに出力する値
000666 C01F E63F             7      AND 03FH    ;ページ3マスク
000668 C021 B1               4      OR  C
000669 C022 5F               4      LD  E,A ;基本スロットでページ3にスロットを割り当てる
00066A C023 7C               4      LD  A,H
00066B C024 E60C             7      AND 00CH
00066D C026 26FC             7      LD  H,HIGH SLTTBL
00066F C028 C9              10      RET
                                
       C02A                     BASIC_START2    EQU $+1
                                ;
                                ; インタースロットコール(DOS1専用)
                                ; ページ3 に配置
                                
                                ;
                                ;   現在のスロットを知る
                                ;in
                                ;HL←上位2ビットで切り替えるページを指定
                                ;out
                                ;A→スロット
       C029                     _GETSLT:
000670 C029 E5              11      PUSH    HL
000671 C02A DBA8            11      IN  A,(0A8H)
                                
000673 C02C CB7C             8      BIT 7,H
000675 C02E 2032            12      JR  NZ,GETSLT_HIGH
000677 C030 CB74             8      BIT 6,H
000679 C032 21C1FC          10      LD  HL,EXPTBL
00067C C035 201B            12      JR  NZ,GETSLT_40H
       C037                     GETSLT_00H:             ;ページ0
00067E C037 E603             7      AND 3
000680 C039 85               4      ADD A,L
000681 C03A 6F               4      LD  L,A
000682 C03B CB7E            13      BIT 7,(HL)
000684 C03D 280F            12      JR  Z,GETSLT_1
000686 C03F C604             7      ADD A,SLTTBL-EXPTBL     ;拡張スロットをワークアリアから取得
000688 C041 6F               4      LD  L,A
000689 C042 7E               7      LD  A,(HL)
       C043                     GETSLT_3:
00068A C043 07               4      RLCA
00068B C044 07               4      RLCA
       C045                     GETSLT_2:
00068C C045 E60C             7      AND 00CH
00068E C047 67               4      LD  H,A
00068F C048 7D               4      LD  A,L
000690 C049 D645             7      SUB LOW SLTTBL - 080H
000692 C04B B4               4      OR  H
000693 C04C E1              10      POP HL
000694 C04D C9              10      RET
       C04E                     GETSLT_1:               ;スロットは拡張されていない
000695 C04E D6C1             7      SUB LOW EXPTBL
000697 C050 E1              10      POP HL
000698 C051 C9              10      RET
                                
       C052                     GETSLT_40H:             ;ページ1
000699 C052 0F               4      RRCA
00069A C053 0F               4      RRCA
00069B C054 E603             7      AND 3
00069D C056 85               4      ADD A,L
00069E C057 6F               4      LD  L,A
00069F C058 CB7E            13      BIT 7,(HL)
0006A1 C05A 28F2            12      JR  Z,GETSLT_1
0006A3 C05C C604             7      ADD A,SLTTBL-EXPTBL
0006A5 C05E 6F               4      LD  L,A
0006A6 C05F 7E               7      LD  A,(HL)
0006A7 C060 18E3            12      JR  GETSLT_2
                                
       C062                     GETSLT_HIGH:
0006A9 C062 CB74             8      BIT 6,H
0006AB C064 21C1FC          10      LD  HL,EXPTBL
0006AE C067 2014            12      JR  NZ,GETSLT_C0H
       C069                     GETSLT_80H:             ;ページ2
0006B0 C069 0F               4      RRCA
0006B1 C06A 0F               4      RRCA
0006B2 C06B 0F               4      RRCA
0006B3 C06C 0F               4      RRCA
0006B4 C06D E603             7      AND 3
0006B6 C06F 85               4      ADD A,L
0006B7 C070 6F               4      LD  L,A
0006B8 C071 CB7E            13      BIT 7,(HL)
0006BA C073 28D9            12      JR  Z,GETSLT_1
0006BC C075 C604             7      ADD A,SLTTBL-EXPTBL
0006BE C077 6F               4      LD  L,A
0006BF C078 7E               7      LD  A,(HL)
0006C0 C079 0F               4      RRCA
0006C1 C07A 0F               4      RRCA
0006C2 C07B 18C8            12      JR  GETSLT_2
                                
       C07D                     GETSLT_C0H:             ;ページ3
0006C4 C07D 07               4      RLCA
0006C5 C07E 07               4      RLCA
0006C6 C07F E603             7      AND 3
0006C8 C081 85               4      ADD A,L
0006C9 C082 6F               4      LD  L,A
0006CA C083 CB7E            13      BIT 7,(HL)
0006CC C085 28C7            12      JR  Z,GETSLT_1
0006CE C087 C604             7      ADD A,SLTTBL-EXPTBL
0006D0 C089 6F               4      LD  L,A
0006D1 C08A 7E               7      LD  A,(HL)
0006D2 C08B 07               4      RLCA
0006D3 C08C 07               4      RLCA
0006D4 C08D 18B4            12      JR  GETSLT_3
                                
       C08F                     SAME_SLOT_00H:          ;ページ0とページ3のスロットが同一
0006D6 C08F D3A8            11      OUT (0A8H),A
0006D8 C091 3AFFFF          13      LD  A,(0FFFFH)  ;拡張スロットの切り替え
0006DB C094 2F               4      CPL
0006DC C095 E6FC             7      AND 0FCH        ;ページ0マスク
0006DE C097 B1               4      OR  C
0006DF C098 32FFFF          13      LD  (0FFFFH),A
0006E2 C09B 77               7      LD  (HL),A
0006E3 C09C C9              10      RET
                                
       C09D                     ENASLT_HIGH:
0006E4 C09D CB74             8      BIT 6,H
0006E6 C09F C0              11      RET NZ          ;ページ3はスロット切り替え不可
                                ;
                                ;ページ2専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
       C0A0                     ENASLT_80H:
0006E7 C0A0 F3               4      DI
0006E8 C0A1 6F               4      LD  L,A
0006E9 C0A2 E603             7      AND 3
0006EB C0A4 07               4      RLCA
0006EC C0A5 07               4      RLCA
0006ED C0A6 07               4      RLCA
0006EE C0A7 07               4      RLCA
0006EF C0A8 4F               4      LD  C,A
0006F0 C0A9 DBA8            11      IN  A,(0A8H)
0006F2 C0AB 06CF             7      LD  B,0CFH  ;ページ2マスク
0006F4 C0AD A0               4      AND B
0006F5 C0AE B1               4      OR  C
0006F6 C0AF CB7D             8      BIT 7,L
0006F8 C0B1 CA89F3          10      JP  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
0006FB C0B4 D5              11      PUSH    DE
0006FC C0B5 CD1AC1          17      CALL    ENATBL_BIOS_CHECK
0006FF C0B8 07               4      RLCA
000700 C0B9 07               4      RLCA
000701 C0BA 4F               4      LD  C,A
000702 C0BB 7B               4      LD  A,E
000703 C0BC CD3B00          17      CALL    ENASUB
000706 C0BF 73               7      LD  (HL),E
000707 C0C0 D1              10      POP DE
000708 C0C1 C9              10      RET
                                ;
                                ;ENASLT
                                ;in
                                ;A←スロット
                                ;HL←上位2ビットで切り替えるページを指定
                                ;破壊
                                ;ABCHL
                                ;
       C0C2                     ENASLT:
000709 C0C2 CB7C             8      BIT 7,H
00070B C0C4 20D7            12      JR  NZ,ENASLT_HIGH
00070D C0C6 CB74             8      BIT 6,H
00070F C0C8 205D            12      JR  NZ,ENASLT_40H
       C0CA                     _ENASLT_00H:
000711 C0CA F3               4      DI
000712 C0CB 67               4      LD  H,A
000713 C0CC E603             7      AND 3
000715 C0CE 4F               4      LD  C,A
000716 C0CF DBA8            11      IN  A,(0A8H)
000718 C0D1 E6FC             7      AND 0FCH    ;ページ0マスク
00071A C0D3 B1               4      OR  C
00071B C0D4 CB7C             8      BIT 7,H
00071D C0D6 CA89F3          10      JP  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
000720 C0D9 D5              11      PUSH    DE
000721 C0DA 44               4      LD  B,H
000722 C0DB CD11C0          17      CALL    ENATBL
000725 C0DE 0F               4      RRCA
000726 C0DF 0F               4      RRCA
000727 C0E0 4F               4      LD  C,A
000728 C0E1 7B               4      LD  A,E
000729 C0E2 BA               4      CP  D
00072A C0E3 D1              10      POP DE
00072B C0E4 28A9            12      JR  Z,SAME_SLOT_00H ;ページ0とページ3のスロットが同一の場合
00072D C0E6 60               4      LD  H,B
       C0E7                     ENASLT_SUB:
00072E C0E7 7C               4      LD  A,H     ;ページ3でスロットを指定するためにページ2のルーチンを使う
00072F C0E8 DDE5            15      PUSH    IX
000731 C0EA DD21B0BF        14      LD  IX,ENASLT_00H
       C0EE                     INT38H_SUB1:
000735 C0EE FDE5            15      PUSH    IY
000737 C0F0 FD2A42F3        20      LD  IY,(RAMAD2-1)
00073B C0F4 CD55C1          17      CALL    CALSLT
00073E C0F7 FDE1            14      POP IY
000740 C0F9 DDE1            14      POP IX
000742 C0FB C9              10      RET
                                
       C0FC                     _ENASLT_00H_S:
000743 C0FC ED7308C1        20      LD  (ENASLT_SP1),SP
000747 C100 ED7B0FC0        20      LD  SP,(BASSP)
00074B C104 CDE7C0          17      CALL    ENASLT_SUB
00074E C107 310000          10      LD  SP,0
       C108                     ENASLT_SP1  EQU $-2
000751 C10A C9              10      RET
                                
       C10B                     INT38H_SUB:
000752 C10B DDE5            15      PUSH    IX
000754 C10D DD21A4BF        14      LD  IX,INT38H_ROM
000758 C111 18DB            12      JR  INT38H_SUB1
                                
       C113                     ENASLT_BIOS:
00075A C113 D1              10      POP DE
00075B C114 7D               4      LD  A,L
00075C C115 CD2400          17      CALL    _ENASLT
00075F C118 D1              10      POP DE
000760 C119 C9              10      RET
                                
       C11A                     ENATBL_BIOS_CHECK:
000761 C11A 57               4      LD  D,A
000762 C11B 3A0000          13      LD  A,(0000H)
000765 C11E FEF3             7      CP  0F3H    ;0000H が DI の場合はページ0は BIOS とみなす
000767 C120 28F1            12      JR  Z,ENASLT_BIOS
000769 C122 65               4      LD  H,L
00076A C123 7A               4      LD  A,D
00076B C124 C311C0          10      JP  ENATBL
                                ;
                                ;ページ1専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
       C127                     ENASLT_40H:
00076E C127 F3               4      DI
00076F C128 6F               4      LD  L,A
000770 C129 E603             7      AND 3
000772 C12B 07               4      RLCA
000773 C12C 07               4      RLCA
000774 C12D 4F               4      LD  C,A
000775 C12E DBA8            11      IN  A,(0A8H)
000777 C130 06F3             7      LD  B,0F3H  ;ページ1マスク
000779 C132 A0               4      AND B
00077A C133 B1               4      OR  C
00077B C134 CB7D             8      BIT 7,L
00077D C136 CA89F3          10      JP  Z,ENASLT_NOEXT
                                            ;拡張スロットの処理
000780 C139 D5              11      PUSH    DE
000781 C13A CD1AC1          17      CALL    ENATBL_BIOS_CHECK
000784 C13D 4F               4      LD  C,A
000785 C13E 7B               4      LD  A,E
000786 C13F CD3B00          17      CALL    ENASUB
000789 C142 73               7      LD  (HL),E
00078A C143 D1              10      POP DE
00078B C144 C9              10      RET
                                
       C145                     CALLF:
00078C C145 E3              19      EX  (SP),HL
00078D C146 F5              11      PUSH    AF
00078E C147 7E               7      LD  A,(HL)
00078F C148 FD67             9      LD  IYH,A
000791 C14A 23               6      INC HL
000792 C14B 7E               7      LD  A,(HL)
000793 C14C DD6F             9      LD  IXL,A
000795 C14E 23               6      INC HL
000796 C14F 7E               7      LD  A,(HL)
000797 C150 DD67             9      LD  IXH,A
000799 C152 23               6      INC HL
00079A C153 F1              10      POP AF
00079B C154 E3              19      EX  (SP),HL
       C155                     CALSLT:
00079C C155 F3               4      DI
00079D C156 08               4      EX  AF,AF'
00079E C157 F5              11      PUSH    AF      ;裏AFを保存
00079F C158 E5              11      PUSH    HL
0007A0 C159 210280          10      LD  HL,08002H
0007A3 C15C 39              11      ADD HL,SP
0007A4 C15D E1              10      POP HL
0007A5 C15E 3007            12      JR  NC,CALSLT_1
0007A7 C160 CD77C1          17      CALL    CALSLT_2
       C163                     CALSLT_E:
0007AA C163 08               4      EX  AF,AF'
0007AB C164 F1              10      POP AF      ;保存した裏AF
0007AC C165 08               4      EX  AF,AF'
0007AD C166 C9              10      RET
       C167                     CALSLT_1:
0007AE C167 ED7373C1        20      LD  (CSSP),SP
0007B2 C16B ED7B0FC0        20      LD  SP,(BASSP)
0007B6 C16F CD77C1          17      CALL    CALSLT_2
0007B9 C172 310000          10      LD  SP,0
       C173                     CSSP    EQU $-2
0007BC C175 18EC            12      JR  CALSLT_E
                                
       C177                     CALSLT_2:
0007BE C177 E5              11      PUSH    HL
0007BF C178 DD7C             9      LD  A,IXH
0007C1 C17A 67               4      LD  H,A
0007C2 C17B CD29C0          17      CALL    _GETSLT
0007C5 C17E FDBC            10      CP  IYH
0007C7 C180 281E            12      JR  Z,CALSLT_3
0007C9 C182 C5              11      PUSH    BC
0007CA C183 F5              11      PUSH    AF
0007CB C184 FD7C             9      LD  A,IYH
0007CD C186 CDC2C0          17      CALL    ENASLT
0007D0 C189 F1              10      POP AF
0007D1 C18A C1              10      POP BC
0007D2 C18B 6F               4      LD  L,A
0007D3 C18C DD7C             9      LD  A,IXH
0007D5 C18E 67               4      LD  H,A
0007D6 C18F E3              19      EX  (SP),HL
0007D7 C190 08               4      EX  AF,AF'
0007D8 C191 CD98F3          17      CALL    JP_IX
0007DB C194 E3              19      EX  (SP),HL
0007DC C195 C5              11      PUSH    BC
0007DD C196 08               4      EX  AF,AF'
0007DE C197 7D               4      LD  A,L
0007DF C198 CDC2C0          17      CALL    ENASLT
0007E2 C19B 08               4      EX  AF,AF'
0007E3 C19C C1              10      POP BC
0007E4 C19D E1              10      POP HL
0007E5 C19E FB               4      EI
0007E6 C19F C9              10      RET
                                
       C1A0                     CALSLT_3:
0007E7 C1A0 E1              10      POP HL
0007E8 C1A1 08               4      EX  AF,AF'
0007E9 C1A2 DDE9             8      JP  (IX)
                                
       C1A4                     RDSLT:
0007EB C1A4 F3               4      DI
0007EC C1A5 D5              11      PUSH    DE
0007ED C1A6 57               4      LD  D,A
0007EE C1A7 CD29C0          17      CALL    _GETSLT
0007F1 C1AA BA               4      CP  D
0007F2 C1AB 2812            12      JR  Z,RDSLT1
0007F4 C1AD 5F               4      LD  E,A
0007F5 C1AE 7A               4      LD  A,D
0007F6 C1AF E5              11      PUSH    HL
0007F7 C1B0 CDC2C0          17      CALL    ENASLT
0007FA C1B3 E1              10      POP HL
0007FB C1B4 46               7      LD  B,(HL)
0007FC C1B5 C5              11      PUSH    BC
0007FD C1B6 7B               4      LD  A,E
0007FE C1B7 E5              11      PUSH    HL
0007FF C1B8 CDC2C0          17      CALL    ENASLT
000802 C1BB E1              10      POP HL
000803 C1BC F1              10      POP AF
000804 C1BD D1              10      POP DE
000805 C1BE C9              10      RET
       C1BF                     RDSLT1:
000806 C1BF 7E               7      LD  A,(HL)
000807 C1C0 D1              10      POP DE
000808 C1C1 C9              10      RET
                                
       C1C2                     WRSLT:
000809 C1C2 F3               4      DI
00080A C1C3 D5              11      PUSH    DE
00080B C1C4 57               4      LD  D,A
00080C C1C5 CD29C0          17      CALL    _GETSLT
00080F C1C8 BA               4      CP  D
000810 C1C9 2810            12      JR  Z,WRSLT1
000812 C1CB F5              11      PUSH    AF
000813 C1CC E5              11      PUSH    HL
000814 C1CD 7A               4      LD  A,D
000815 C1CE CDC2C0          17      CALL    ENASLT
000818 C1D1 E1              10      POP HL
000819 C1D2 73               7      LD  (HL),E
00081A C1D3 F1              10      POP AF
00081B C1D4 E5              11      PUSH    HL
00081C C1D5 CDC2C0          17      CALL    ENASLT
00081F C1D8 E1              10      POP HL
000820 C1D9 D1              10      POP DE
000821 C1DA C9              10      RET
                                
       C1DB                     WRSLT1:
000822 C1DB 73               7      LD  (HL),E
000823 C1DC D1              10      POP DE
000824 C1DD C9              10      RET
                                
       C1DE                     INT38H:
000825 C1DE F3               4      DI
000826 C1DF F5              11      PUSH    AF
000827 C1E0 C5              11      PUSH    BC
000828 C1E1 E5              11      PUSH    HL
000829 C1E2 210280          10      LD  HL,08002H
00082C C1E5 39              11      ADD HL,SP
00082D C1E6 380F            12      JR  C,INT38H1
00082F C1E8 ED73F4C1        20      LD  (INTSP),SP  ;スタックポインタ保存
000833 C1EC ED7B0FC0        20      LD  SP,(BASSP)
000837 C1F0 CD0BC1          17      CALL    INT38H_SUB
00083A C1F3 310000          10      LD  SP,0
       C1F4                     INTSP   EQU $-2
00083D C1F6 AF               4      XOR A
       C1F7                     INT38H1:
00083E C1F7 DC0BC1          17      CALL    C,INT38H_SUB
000841 C1FA E1              10      POP HL
000842 C1FB C1              10      POP BC
000843 C1FC F1              10      POP AF
000844 C1FD FB               4      EI
000845 C1FE C9              10      RET
[EOF:BIOS.ASM:UTF_8]
       C1FF                     LAST:
[EOF:DOSCMD.ASM:UTF_8]
