;
;	Tablacus DOS cmd
;
	LD	C,06FH		;(BDOS)MSX-DOS のバージョン番号の獲得
	CALL	BDOS
	LD	A,B
	LD	(MAJOR_VER),A
	LD	HL,08A91H
	SBC	HL,DE
	JR	NZ,NOTABLACUS
	LD	A,1
	LD	(MAJOR_VER),A
NOTABLACUS:
					;BASICのフリーエリア位置をずらす
	LD	HL,BASIC_START1
	OR	A
	JR	Z,DOS1START
	LD	HL,BASIC_START2
DOS1START:
	LD	(TXTTAB),HL
	XOR	A
	LD	(HL),A
	DEC	HL
	LD	(HL),A
	LD	HL,0
	LD	(BASIC_DEF),HL

	DI
	LD	A,(RAMAD0)
	CALL	ENASLT_00H

	DB	03EH	;LD A,?
	POP	AF
	LD	(H_CMD),A

	LD	A,0C3H		;JP

	LD	HL,CPM_WBOOT
	LD	(00000H),A
	LD	(00001H),HL

	LD	HL,BDOS0
	LD	(00005H),A
	LD	(00006H),HL

	LD	HL,BDOS1
	LD	(BDOS0),A
	LD	(BDOS0+1),HL

	LD	(H_CMD+1),A
	LD	HL,_CMD
	LD	(H_CMD+2),HL

	LD	A,(MAJOR_VER)
	OR	A
	JR	NZ,ISC_END
				;インタースロットコール
	LD	A,0C3H		;JP
	LD	HL,RDSLT
	LD	(_RDSLT),A
	LD	(_RDSLT+1),HL

	LD	HL,WRSLT
	LD	(_WRSLT),A
	LD	(_WRSLT+1),HL

	LD	HL,CALSLT
	LD	(_CALSLT),A
	LD	(_CALSLT+1),HL

	LD	HL,ENASLT
	LD	(_ENASLT),A
	LD	(_ENASLT+1),HL

	LD	HL,CALLF
	LD	(_CALLF),A
	LD	(_CALLF+1),HL
				;割り込み
	LD	HL,INT38H
	LD	(00038H),A
	LD	(00038H+1),HL

	LD	HL,AT_3B
	LD	DE,ENASUB
	LD	BC,AT_3B_E-AT_3B
	LDIR
ISC_END:
	LD	A,(EXPTBL)
	CALL	ENASLT_00H
	EI

	LD	DE,TITLE
	LD	C,9
	CALL	BDOS
	LD	A,(MAJOR_VER)
	OR	A
	JR	Z,MSX1
	DEC	A
	JR	Z,TABLACUS
	LD	E,'2'
	LD	C,2
	CALL	BDOS
	JR	Z,MSX1
TABLACUS:
	LD	DE,TITLET
	LD	C,9
	CALL	BDOS
MSX1:
	LD	DE,TITLE2
	LD	C,9
	CALL	BDOS
	RET

; Version
TITLE:
	DB	"Tablacus DOS$"
TITLE2:
	DB	" cmd v0.01"
	DB	00DH,00AH,'$'
TITLET:
	DB	"(ROM)$"
